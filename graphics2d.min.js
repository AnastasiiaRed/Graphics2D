!function(a,b){function c(a,b,c,d){c<0&&(c=-c,a-=c),d<0&&(d=-d,b-=d),this.x=this.x1=a,this.y=this.y1=b,this.w=this.width=c,this.h=this.height=d,this.x2=a+c,this.y2=b+d,this.cx=a+c/2,this.cy=b+d/2}function d(a){a(this.resolve.bind(this),this.reject.bind(this))}function e(a){return function(b){return this.argument(a,b)}}function f(a,b){var c=a[b];return a=F.call(a,b+1),function(){this[c].apply(this,a)}}function g(a){return"[object Object]"===E.call(a)}function h(a){return+a===a||a+""===a&&I.test(a)}function i(a){return a instanceof Image||g(a)&&G(a,"image")||a+""===a&&!(a.indexOf("http://")&&a.indexOf("https://")&&a.indexOf("./")&&a.indexOf("../")&&a.indexOf("data:image/")&&a.indexOf("<svg"))}function j(a,c){if(a!==b){if(!a)return 0;if(C.snapToPixels&&!c)return Math.round(C.distance(a,!0)/C.snapToPixels)*C.snapToPixels;if(+a===a)return"px"!==C.unit?C.distance(a+""+C.unit):a;if(a+="",a.indexOf("px")===a.length-2)return parseInt(a);if(!C.units)if(D){var d=D.createElement("div");D.body.appendChild(d),C.units={},O.forEach(function(a){d.style.width="1"+a,C.units[a]=parseFloat(getComputedStyle(d).width)}),D.body.removeChild(d)}else C.units=P;var e=a.replace(/[\d\.]+?/g,"");return a=a.replace(/[^\d\.]+?/g,""),""===e?a:1===C.snapToPixels?Math.round(C.units[e]*a):C.units[e]*a}}function k(a,b){b||(b=a,a=null);var c=function(){return this.initialize&&this.initialize.apply(this,arguments)};if(a){var d=function(){};d.prototype=a.prototype,c.prototype=new d,c.prototype.superclass=a.prototype,c.prototype.constructor=c,c.prototype.super=function(b,c){if(!this.superclass.superclass||!this.superclass.superclass[b])return this.superclass[b].apply(this,c);var d=this.superclass;this.superclass=this.superclass.superclass;var e=d[b].apply(this,c);return this.superclass=a.prototype,e}}return b.mixins&&b.mixins.forEach(function(a){K(c.prototype,k.mixins[a])}),K(c.prototype,b),c}function l(a){var b=a[2];return function(){return this[b].apply(this,Array.prototype.slice.call(a,3))}}function m(a,b){return R||(R=D.createElement("canvas")),R.width=a,R.height=b,R}function n(a){K(this,a)}function o(a){K(this,a)}function p(a){for(var b=new o({}),c=0;c<a.length;c++);return b}function q(a){return["mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled"].forEach(function(b){b in a&&(S=b)}),q=function(){return S},S}var r,s,t,u,v,w,x,y,z,A,B,C={},D=a.document,E=Object.prototype.toString,F=Array.prototype.slice,G=Function.prototype.call.bind(Object.prototype.hasOwnProperty),H=/^\d*\.\d+$/,I=/^(\d+|(\d+)?\.\d+)(em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|px|pt|pc)?$/,J=a.URL||a.webkitURL||a,K=Object.assign?Object.assign:function(a,b){for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a},L={mouse:["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","mousewheel","blur","focus"],touch:["touchstart","touchmove","touchend","touchcancel"],pointer:["pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"],keyboard:["keypress","keydown","keyup"]},M=["keypress","keydown","keyup"],N=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){return a.setTimeout(b,1e3/60)};a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.oCancelAnimationFrame||a.msCancelAnimationFrame||a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||a.clearTimeout;C.renderers={},C.bounds=function(a,b,d,e){return new c(a,b,d,e)},d.prototype={resolve:function(a){this.success&&this.success(a)},reject:function(a){this.error&&this.error(a)},then:function(a,b){this.success=a,this.error=b}},C.Class=k,C.Bounds=c,C.extend=K,C.argument=e,C.wrap=f,C.isObject=g,C.isNumberLike=h,C.isPatternLike=i,C.dashes={shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},C.fileTypes={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",webp:"image/webp"},C.corners={left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],center:[.5,.5],"left top":[0,0],"top left":[0,0],"left bottom":[0,1],"bottom left":[0,1],"right top":[1,0],"top right":[1,0],"right bottom":[1,1],"bottom right":[1,1],lt:[0,0],tl:[0,0],lb:[0,1],bl:[0,1],rt:[1,0],tr:[1,0],rb:[1,1],br:[1,1]},C.colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",chucknorris:"c00000",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},C.coordsOfElement=function(b){var c=b.getBoundingClientRect(),d=a.getComputedStyle(b);return{x:c.left+parseInt(d.borderLeftWidth||0)+parseInt(d.paddingLeft||0),y:c.top+parseInt(d.borderTopWidth||0)+parseInt(d.paddingTop||0)}},C.clone=function(a){var b=new a.constructor;for(var c in a)G(a,c)&&("object"!=typeof a[c]||a[c]instanceof r||a[c]instanceof Image?b[c]=a[c]:b[c]=C.clone(a[c]));return b},C.parseTransform=function(a,c){if(Array.isArray(a.transform))return a.transform;var d=[1,0,0,1,0,0];if("attributes"===a.transform)(a.transformOrder||"translate rotate scale skew").split(" ").forEach(function(e){a[e]!==b&&(d=C.transforms[e](d,a[e],c))});else{a.transform.split(")").forEach(function(a){if(""!==(a=a.trim())){var b=a.match(/[a-z]+/),e=a.split("(")[1].split(",").map(function(a){return a.trim()});d=C.transforms[b](d,e,c)}})}return d},C.transforms={translate:function(a,b){return a[4]+=+b[0],a[5]+=+b[1],a},scale:function(a,b,c){+b===b?b=[b,b]:+b[1]!==b[1]&&(b=[b[0],b[0],b[1]]);var d=c.corner(b[2]||"center");return a=C.transform(a,[1,0,0,1,d[0],d[1]]),a=C.transform(a,[b[0],0,0,b[1],0,0]),a=C.transform(a,[1,0,0,1,-d[0],-d[1]])},skew:function(a,b,c){+b===b?b=[b,b]:+b[1]!==b[1]&&(b=[b[0],b[0],b[1]]),b[0]=+b[0]/180*Math.PI,b[1]=+b[1]/180*Math.PI;var d=c.corner(b[2]||"center");return a=C.transform(a,[1,0,0,1,d[0],d[1]]),a=C.transform(a,[1,Math.tan(b[1]),Math.tan(b[0]),1,0,0]),a=C.transform(a,[1,0,0,1,-d[0],-d[1]])},rotate:function(a,b,c){+b===b&&(b=[b]),b[0]=+b[0]/180*Math.PI;var d=c.corner(b[1]||"center");return a=C.transform(a,[1,0,0,1,d[0],d[1]]),a=C.transform(a,[Math.cos(b[0]),Math.sin(b[0]),-Math.sin(b[0]),Math.cos(b[0]),0,0]),a=C.transform(a,[1,0,0,1,-d[0],-d[1]])}},C.isIdentityTransform=function(a){return 0===a[5]&&0===a[4]&&1===a[3]&&0===a[2]&&0===a[1]&&1===a[0]},C.transform=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},C.transformPoint=function(a,b){return[a[0]*b[0]+a[2]*b[1]+a[4],a[1]*b[0]+a[3]*b[1]+a[5]]},C.inverseTransform=function(a){var b=a[0]*a[3]-a[2]*a[1];return 0===b?null:[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,-(a[3]*a[4]-a[2]*a[5])/b,(a[1]*a[4]-a[0]*a[5])/b]},C.color=function(a){if(a!==b){if(Array.isArray(a))return a.slice(0,4);if(a+""!==a)throw"Not a color: "+a.toString();if(0===a.indexOf("rgb")){a=a.substring(a.indexOf("(")+1,a.length-1).replace(/\s/g,"").split(",");var c=a[3];return a=a.slice(0,3).map(function(a,b){return a.indexOf("%")>0?Math.round(2.55*parseInt(a)):parseInt(a)}),c===b&&(c=1),a.push(Number(c)),a}return"#"===a[0]?(a=a.substring(1),3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16),1]):a in C.colors?C.color("#"+C.colors[a]):"rand"===a?[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),1]:[0,0,0,0]}},C.angleUnit="grad",C.unit="px";var O="pt em in cm mm pc ex ch rem v wvh vmin vmax".split(" "),P={px:1,ch:8,cm:37.78125,em:16,ex:7.15625,in:96,mm:3.765625,pc:16,pt:1.328125,rem:16,v:16,vmax:13.65625,vmin:4.78125,wvh:16};C.snapToPixels=1,C.distance=j,k.mixins={AttrMixin:{attrs:{},attrHooks:{},attr:function(a,b){return a.constructor===Array?a.map(function(a){return this.attrs[a]},this):"string"!=typeof a?(Object.keys(a).forEach(function(b){this.attr(b,a[b])},this),this):1===arguments.length?this.attrs[a]:(this.attrs[a]=val,this)}},EventMixin:{listeners:{},eventHooks:{},on:function(a,b,c){return a.constructor!==String?(Object.keys(a).forEach(function(b){this.on(b,a[b])},this),this):(b&&(b.constructor===Function?(c=b,b=null):b.constructor===String&&Array.prototype.splice.call(arguments,1,0,null)),c.constructor===String&&(c=l(arguments)),this.listeners[a]||(this.listeners[a]=[],this.eventHooks[a]&&this.eventHooks[a].init&&this.eventHooks[a].init.call(this,a)),this.listeners[a].push({callback:c,options:b}),this)},off:function(a,b){var c=this.listeners[a],d=this.eventHooks[a];if(c)if(b){for(var e=0;e<c.length;e++)if(c[e].callback===b){c.splice(e,1);break}d&&!c.length&&d.teardown&&(this.listeners[a]=null,d.teardown.call(this,a))}else this.listeners[a]=null,d&&d.teardown&&d.teardown.call(this,a);return this},fire:function(a,b,c){var d=this.listeners[a];return d&&(c&&(d=d.filter(c,this)),d.forEach(function(a){a.callback.call(this,b)},this)),this}},LinkMixin:{links:[],pushLink:function(){},callLinks:function(a){}}},k.attr=function(a,c){if(Array.isArray(a))return a.map(function(a){return this.attr(a)},this);if(a+""!==a)return Object.keys(a).forEach(function(b){this.attr(b,a[b])},this),this;if(1===arguments.length)return this.attrHooks[a]&&this.attrHooks[a].get?this.attrHooks[a].get.call(this):this.attrs[a];if(this.attrHooks[a]&&this.attrHooks[a].set){var d=this.attrHooks[a].set.call(this,c);null!==d&&(this.attrs[a]=d===b?c:d)}else this.attrs[a]=c;return this};var r;r=function(a){this.canvas=a,this.context=a.getContext("2d"),this.elements=[],this.listeners={},this.attrs={transform:"attributes"},this.cache={},this.updateNow=this.updateNow.bind(this)},r.prototype={object:function(a){return this.push(K(new s,a))},rect:function(){return this.push(new u(arguments))},circle:function(){return this.push(new v(arguments))},path:function(){return this.push(new x(arguments))},image:function(){return this.push(new y(arguments))},text:function(){return this.push(new z(arguments))},line:function(a,b,c,d,e){return this.path([[a,b],[c,d]],null,e)},quadratic:function(a,b,c,d,e,f,g){return this.path([[a,b],[c,d,e,f]],null,g)},bezier:function(a,b,c,d,e,f,g,h,i){return this.path([[a,b],[c,d,e,f,g,h]],null,i)},arcTo:function(a,b,c,d,e,f,g){return this.path([[a,b],["arcTo",a,b,c,d,e,f]],null,g)},useCache:!1,gradient:function(a,b,c,d){return new A(a,b,c,d,this)},pattern:function(a,b){return new B(a,b,this)},push:function(a){if(a.context=this,this.elements.push(a),a.draw){var b=this.context;b.save(),this.matrix?b.setTransform(this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5]):b.setTransform(1,0,0,1,0,0),a.draw(b),b.restore()}return a.update=a.updateFunction,a},update:function(){this._willUpdate||(this._willUpdate=!0,N(this.updateNow))},updateNow:function(){var a=this.context;a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,a.canvas.width,a.canvas.height);var b=this.getTransform(),c=this.attrs.dpi||1;C.isIdentityTransform(b)?1!==c&&a.setTransform(c,0,0,c,0,0):a.setTransform(b[0]/c,b[1],b[2],b[3]/c,b[4],b[5]),this.elements.forEach(function(b){b.draw(a)}),a.restore(),this._willUpdate=!1},getObjectInPoint:function(a,b,c){for(var d=this.elements,e=d.length;e--;)if(d[e].isPointIn&&(d[e].attrs.interaction||!c)&&d[e].isPointIn(a,b,"mouse"))return d[e];return null},each:function(a){if(a+""===a){var b=F.call(arguments,1),c=a;a=function(a){a[c].apply(a,b)}}return this.elements.slice().forEach(a,this),this},contextCoords:function(a,b){var c=C.coordsOfElement(this.canvas);return[a-c.x,b-c.y]},attr:k.attr,attrHooks:{width:{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a,this.canvas.style.width=this.canvas.width/(this.attrs.dpi||1)+"px",this.update()}},height:{get:function(){return this.canvas.height},set:function(a){this.canvas.height=a,this.canvas.style.height=this.canvas.height/(this.attrs.dpi||1)+"px",this.update()}},dpi:{get:function(){return this.attrs.dpi||1},set:function(a){this.canvas.style.width=this.canvas.width/a+"px",this.canvas.style.height=this.canvas.height/a+"px",this.update()}},transform:{set:function(a){this.cache.transform=null,this.update()}},translate:{get:function(){return this.attrs.translate||[0,0]},set:function(a){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},rotate:{get:function(){return this.attrs.rotate||0},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},scale:{get:function(){return this.attrs.scale||[1,1]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},skew:{get:function(){return this.attrs.skew||[0,0]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}}},getTransform:function(){if(this.cache.transform)return this.cache.transform;var a=C.parseTransform(this.attrs,this);return this.cache.transform=a,a},corner:function(a){return[this.canvas.width*C.corners[a][0],this.canvas.height*C.corners[a][1]]}},Object.assign(r.prototype,k.mixins.EventMixin,{hoverElement:null,focusElement:null,listeners:{},eventHooks:{}}),C.browserCommonEvent={init:function(a){this.canvas&&this.eventHooks[a].canvas&&this.canvas.addEventListener(a,this.listeners[a+"__canvasListener"]=this.eventHooks[a].canvas.bind(this))},teardown:function(a){this.canvas&&N(function(){this.listeners[a]||this.canvas.removeEventListener(a,this.listeners[a+"__canvasListener"])}.bind(this))},canvas:function(a){a.cancelContextPropagation=function(){},this.fire(a.type,a)}},C.browserMouseEvent=Object.assign({},C.browserCommonEvent,{canvas:function(a){var b=!0;a.cancelContextPropagation=function(){b=!1};var c=this.contextCoords(a.clientX,a.clientY);a.contextX=c[0],a.contextY=c[1],a.targetObject=this.getObjectInPoint(a.contextX,a.contextY,!0),a.targetObject&&a.targetObject.fire&&a.targetObject.fire(a.type,a),b&&this.fire(a.type,a)}}),C.browserTouchEvent=Object.assign({},C.browserCommonEvent,{canvas:function(a){var b=!0;a.cancelContextPropagation=function(){b=!1},["touches","changedTouches","targetTouches"].forEach(function(b){a[b]&&Array.prototype.forEach.call(a[b],function(a){var b=this.contextCoords(a.clientX,a.clientY);a.contextX=b[0],a.contextY=b[1],a.targetObject=this.getObjectInPoint(a.contextX,a.contextY,!0)},this)},this),Array.prototype.forEach.call(a.touches,function(b){b.targetObject&&b.targetObject.fire&&a.targetObject.fire(a.type,a)},this),b&&this.fire(a.type,a)}});var Q=a.document?{mouse:C.browserMouseEvent,touch:C.browserTouchEvent,pointer:C.browserCommonEvent,keyboard:C.browserCommonEvent}:{};Object.keys(L).forEach(function(a){L[a].forEach(function(b){r.prototype.eventHooks[b]=Q[a],r.prototype[b]=function(a){return a.constructor===Function?this.on(b,a):a.constructor===String?this.on.apply(this,[b].concat(F.call(arguments))):this.fire(a)}})}),C.Context=r,C.contexts={"2d":r};var R;s=new k({initialize:function(a){this.listeners={},this.styles={},this.cache={},this.attrs={interaction:!0,visible:!0,transform:"attributes"}},updateFunction:function(){return this.context&&this.context.update(),this},update:function(){return this},clone:function(a,b,c){var d=new this.constructor([],this.context);return d.attrs=!1===a?this.attrs:K({},this.attrs),!1===b?(d.styles=this.styles,d.matrix=this.matrix):(d.styles=K({},this.styles),this.matrix&&(d.matrix=this.matrix.slice())),d.listeners=!1===c?this.listeners:K({},this.listeners),this.context.push(d)},remove:function(){return this.context.elements.splice(this.context.elements.indexOf(this),1),this.update(),this.context=null,this},attr:k.attr,attrHooks:n.prototype={z:{get:function(){return this.context.elements.indexOf(this)},set:function(a){var b=this.context.elements;"top"===a&&(a=b.length),b.splice(this.context.elements.indexOf(this),1),b.splice(a,0,this),this.update()}},visible:{set:function(){this.update()}},fill:{get:function(){return this.styles.fillStyle},set:function(a){this.styles.fillStyle=a,this.update()}},stroke:{set:function(a){s.processStroke(a,this.styles),this.update()}},strokeMode:{get:function(){return this.attrs.strokeMode||"over"},set:function(a){this.update()}},shadow:{set:function(a){s.processShadow(a,this.styles),this.update()}},opacity:{get:function(){return this.styles.globalAlpha!==b?this.styles.globalAlpha:1},set:function(a){this.styles.globalAlpha=+a,this.update()}},composite:{get:function(){return this.styles.globalCompositeOperation},set:function(a){this.styles.globalCompositeOperation=a,this.update()}},clip:{set:function(a){a.context=this.context,this.attrs.clip=a,this.update()}},cursor:{set:function(a){}},transform:{set:function(a){this.cache.transform=null,this.update()}},translate:{get:function(){return this.attrs.translate||[0,0]},set:function(a){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},rotate:{get:function(){return this.attrs.rotate||0},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},scale:{get:function(){return this.attrs.scale||[1,1]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},skew:{get:function(){return this.attrs.skew||[0,0]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}}},getTransform:function(){if(this.cache.transform)return this.cache.transform;var a=C.parseTransform(this.attrs,this);return this.cache.transform=a,a},processObject:function(a,c){return["opacity","composite","clip","visible","interaction","z","transform","transformOrder","rotate","skew","scale"].forEach(function(c){a[c]!==b&&this.attr(c,a[c])},this),c.map(function(b){return a[b]})},isPointInBefore:function(a,b,c){if(c&&!1!==c.transform){var d=this.getTransform();if(!C.isIdentityTransform(d)){var e=C.inverseTransform(d);return C.transformPoint(e,[a,b])}}return[a,b,c]},bounds:function(a,b,d){if(("fill"===d||!d)&&this.styles.strokeStyle){var e=(this.styles.lineWidth||1)/2;"strokeExclude"===d&&(e=-e),a[0]-=e,a[1]-=e,a[2]+=2*e,a[3]+=2*e}if(!1!==b&&this.matrix){var f=[C.transformPoint(this.matrix,[a[0],a[1]]),C.transformPoint(this.matrix,[a[0]+a[2],a[1]]),C.transformPoint(this.matrix,[a[0],a[1]+a[3]]),C.transformPoint(this.matrix,[a[0]+a[2],a[1]+a[3]])];if("tight"===b)return f;a[0]=Math.min(f[0][0],f[1][0],f[2][0],f[3][0]),a[1]=Math.min(f[0][1],f[1][1],f[2][1],f[3][1]),a[2]=Math.max(f[0][0],f[1][0],f[2][0],f[3][0])-a[0],a[3]=Math.max(f[0][1],f[1][1],f[2][1],f[3][1])-a[1]}return new c(a[0],a[1],a[2],a[3])},corner:function(a,b){return Array.isArray(a)?a:(b=b instanceof c?b:this.bounds(b),[b.x+b.w*C.corners[a][0],b.y+b.h*C.corners[a][1]])},on:function(a,b,c){if(a+""!==a)for(var d in a)G(a,d)&&this.on(d,a[d]);return"function"==typeof b?(c=b,b=null):b+""===b&&Array.prototype.splice.call(arguments,1,0,null),c+""===c&&(c=f(arguments,2)),this.context.listener(a),(this.listeners[a]||(this.listeners[a]=[])).push(c),this},off:function(a,b){return a?b?(this.listeners[a].splice(this.listeners[a].indexOf(b),1),this):(this.listeners[a]=null,this):(this.listeners={},this)},fire:function(a,b,c){if(!this.listeners[a])return this;var d=this.listeners[a];return c&&(d=d.filter(c,this)),d.forEach(function(a){a.call(this,b)},this),this},preDraw:function(a){a.save();var b=this.styles;Object.keys(b).forEach(function(c){a[c]=b[c]}),b.fillStyle&&b.fillStyle.toCanvasStyle&&(a.fillStyle=b.fillStyle.toCanvasStyle(a,object)),b.strokeStyle&&b.strokeStyle.toCanvasStyle&&(a.strokeStyle=b.strokeStyle.toCanvasStyle(a,object)),b.lineDash&&(a.setLineDash?a.setLineDash(b.lineDash):a.mozDash=b.lineDash),this.attrs.clip&&(this.attrs.clip.matrix?(a.save(),a.transform.apply(a,this.attrs.clip.matrix),this.attrs.clip.processPath(a),a.restore()):this.attrs.clip.processPath(a),a.clip());var c=this.getTransform();C.isIdentityTransform(c)||a.transform(c[0],c[1],c[2],c[3],c[4],c[5])},postDraw:function(a){var b=this.styles;b.fillStyle&&a.fill(this.attrs.fillRule),b.strokeStyle&&a.stroke(),a.restore()},toDataURL:function(a,c){if(c===b){if("function"!=typeof this.bounds)throw"Object #"+this.attr("z")+" can't be rasterized: need the bounds.";c=this.bounds()}a===b?a="image/png":a in C.fileTypes&&(a=C.fileTypes[a]);var d=m(c.width,c.height),e=d.getContext("2d");return e.setTransform(1,0,0,1,-c.x,-c.y),this.draw(e),d.toDataURL(a.type||a,a.quality||1)},toBlob:function(a,b,c,d){},toImageData:function(a){if(a===b){if("function"!=typeof this.bounds)throw"Object #"+this.z()+" can't be rasterized: need the bounds.";a=this.bounds()}var c=m(a.width,a.height),d=c.getContext("2d");return d.setTransform(1,0,0,1,-a.x,-a.y),this.draw(d),d.getImageData(0,0,a.width,a.height)},animate:function(a,c,d){if(a+""!==a)return d=+c!==c&&c?"function"==typeof c?{callback:c}:c:{duration:c,easing:d,callback:arguments[3]},Object.keys(a).forEach(function(b,c){this.animate(b,a[b],d),0===c&&(d.queue=!1,d.callback=null)},this),this;if(!this.attrHooks[a]||!this.attrHooks[a].anim)throw'Animation for "'+a+'" is not supported';+d!==d&&d?"function"==typeof d&&(d={callback:d}):d={duration:d,callback:arguments[4],easing:arguments[3]};var e=new t(d.duration,d.easing,d.callback);e.prop=a,e.tick=this.attrHooks[a].anim,e.tickContext=this,e.prePlay=function(){this.fx=e,this.attrHooks[a].preAnim.call(this,e,c)}.bind(this),e.elem=this,d.name&&(e.name=d.name);var f=d.queue;return!1!==f&&(!0===f||f===b?(this._queue||(this._queue=[]),f=this._queue):f instanceof s&&(f=f._queue),e.queue=f,f.push(e),f.length>1)?this:(e.play(),this)},pause:function(a){return this._paused||(this._paused=[]),t.queue.slice().forEach(function(b){b.elem!==this||b.name!==a&&a||(b.pause(),this._paused.push(b))},this),this},continue:function(a){if(this._paused)return this._paused.slice().forEach(function(b,c){a&&b.name!==a||(b.continue(),this._paused.splice(c,1))},this),this}}),s.AttrHooks=n,s.processStroke=function(a,c){if(a+""===a){a=a.replace(/\s*\,\s*/g,",").split(" ");for(var d,e=a.length,f=!1,g=!1;e--;)H.test(a[e])?d=parseFloat(a[e]):h(a[e])?c.lineWidth=C.distance(a[e]):"round"===a[e]?(f||(c.lineJoin="round"),g||(c.lineCap=c.lineCap||"round")):"miter"===a[e]||"bevel"===a[e]?(f=!0,c.lineJoin=a[e]):"butt"===a[e]||"square"===a[e]?(g=!0,c.lineCap=a[e]):"["===a[e][0]?c.lineDash=a[e].substr(1,a[e].length-2).split(","):a[e]in C.dashes?c.lineDash=C.dashes[a[e]]:a[e].lastIndexOf("ml")===a[e].length-2?c.miterLimit=+a[e].slice(0,a[e].length-2):0===a[e].indexOf("do")?c.lineDashOffset=C.distance(a[e].slice(2)):c.strokeStyle=a[e];d&&(a=C.color(c.strokeStyle),a[3]=d,c.strokeStyle="rgba("+a.join(",")+")")}else{if(a.color!==b&&(c.strokeStyle=a.color),a.opacity!==b&&c.strokeStyle){var i=C.color(c.strokeStyle);i[3]=a.opacity,c.strokeStyle="rgba("+i.join(",")+")"}a.width!==b&&(c.lineWidth=C.distance(a.width)),a.join!==b&&(c.lineJoin=a.join),a.cap!==b&&(c.lineCap=a.cap),a.miterLimit!==b&&(c.miterLimit=a.miterLimit),a.dash!==b&&(a.dash in C.dashes?c.lineDash=C.dashes[a.dash]:c.lineDash=a.dash),a.dashOffset!==b&&(c.lineDashOffset=C.distance(a.dashOffset))}},s.processShadow=function(a,c){if(a+""===a){var d=["shadowOffsetX","shadowOffsetY","shadowBlur"];a=a.replace(/\s*\,\s*/g,",").split(" ");for(var e=0;e<a.length;e++)isNaN(+a[e][0])?c.shadowColor=a[e]:c[d.shift()]=C.distance(a[e])}else a.x!==b&&(c.shadowOffsetX=C.distance(a.x)),a.y!==b&&(c.shadowOffsetY=C.distance(a.y)),a.blur!==b&&(c.shadowBlur=C.distance(a.blur||0)),a.color&&(c.shadowColor=a.color)},C.Drawable=s,M.forEach(function(a){s.prototype[a]=r.prototype[a]}),t=new k({initialize:function(a,b,c){this.duration=a||t.default.duration,b+""===b?(b.indexOf("(")>-1&&(this.easingParam=+b.split("(")[1].split(")")[0],b=b.split("(")[0]),this.easing=t.easing[b]):this.easing=b||t.easing.default,this.callback=c},play:function(a,b){this.prePlay&&this.prePlay(),a&&(this.tick=a),b&&(this.tickContext=b),this.startTime=Date.now(),this.endTime=this.startTime+this.duration,t.queue.length||N(t.do),t.queue.push(this)},pause:function(){this.pauseTime=Date.now(),t.queue.splice(t.queue.indexOf(this),1)},continue:function(){var a=this.pauseTime-this.startTime;this.startTime=Date.now()-a,this.endTime=this.startTime+this.duration,t.queue.length||N(t.do),t.queue.push(this)}}),t.queue=[],t.do=function(){for(var a,b,c=Date.now(),d=0;d<t.queue.length;d++)a=t.queue[d],(b=(c-a.startTime)/a.duration)<0||(b>1&&(b=1),a.now=c,a.pos=a.easing(b,a.easingParam),a.tick.call(a.tickContext,a),1===b&&(a.callback&&a.callback.call(a.tickContext,a),a.queue&&(a.queue.shift(),a.queue.length&&a.queue[0].play()),t.queue.splice(t.queue.indexOf(a),1)));t.queue.length&&N(t.do)},s.prototype.attrHooks._num={preAnim:function(a,b){a.startValue=this.attr(a.prop),a.delta=b-a.startValue,b+""===b&&(0===b.indexOf("+=")?a.delta=+b.substr(2):0===b.indexOf("-=")&&(a.delta=-b.substr(2)))},anim:function(a){this.attrs[a.prop]=a.startValue+a.delta*a.pos,this.update()}},s.prototype.attrHooks._numAttr={preAnim:s.prototype.attrHooks._num.preAnim,anim:function(a){this.attr(a.prop,a.startValue+a.delta*a.pos)}},t.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},sqrt:function(a){return Math.sqrt(a)},pow:function(a,b){return Math.pow(a,b||6)},expo:function(a,b){return Math.pow(b||2,8*a-8)},circ:function(a){return 1-Math.sin(Math.acos(a))},sine:function(a){return 1-Math.cos(a*Math.PI/2)},back:function(a,b){return Math.pow(a,2)*((b||1.618)*(a-1)+a)},bounce:function(a){for(var b=0,c=1;1;b+=c,c/=2)if(a>=(7-4*b)/11)return c*c-Math.pow((11-6*b-11*a)/4,2)},elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b||1)/3)},bezier:function(a,b){}},t.easing.default=t.easing.swing,["quad","cubic","quart","quint"].forEach(function(a,b){t.easing[a]=function(a){return Math.pow(a,b+2)}}),Object.keys(t.easing).forEach(function(a){t.easing[a+"In"]=t.easing[a],t.easing[a+"Out"]=function(b,c){return 1-t.easing[a](1-b,c)},t.easing[a+"InOut"]=function(b,c){return b>=.5?t.easing[a](2*b,c)/2:(2-t.easing[a](2*(1-b),c))/2}}),t.default={duration:500},C.animation=function(a,b,c){return new t(a,b,c)},u=new k(s,{initialize:function(a){this.super("initialize",arguments),g(a[0])&&(a=this.processObject(a[0],u.args)),this.attrs.x=a[0],this.attrs.y=a[1],this.attrs.width=a[2],this.attrs.height=a[3],a[4]&&(this.styles.fillStyle=a[4]),a[5]&&(this.attrs.stroke=a[5],s.processStroke(a[5],this.styles))},attrHooks:new n({x:{set:function(a){this.update()}},y:{set:function(a){this.update()}},width:{set:function(a){this.update()}},height:{set:function(a){this.update()}},x1:{get:function(){return this.attrs.x},set:function(a){return this.attrs.width+=this.attrs.x-a,this.attrs.x=a,this.update(),null}},y1:{get:function(){return this.attrs.y},set:function(a){return this.attrs.height+=this.attrs.y-a,this.attrs.y=a,this.update(),null}},x2:{get:function(){return this.attrs.x+this.attrs.width},set:function(a){return this.attrs.width=a-this.attrs.x,this.update(),null}},y2:{get:function(){return this.attrs.y+this.attrs.height},set:function(a){return this.attrs.height=a-this.attrs.y,this.update(),null}}}),isPointIn:function(a,b,c){var d=this.isPointInBefore(a,b,c);return a=d[0],b=d[1],a>this.attrs.x&&b>this.attrs.y&&a<this.attrs.x+this.attrs.width&&b<this.attrs.y+this.attrs.height},bounds:function(a,b){return this.super("bounds",[[this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height],a,b])},draw:function(a){this.attrs.visible&&(this.preDraw(a),this.styles.fillStyle&&a.fillRect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height),this.styles.strokeStyle&&a.strokeRect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height),a.restore())},processPath:function(a){a.beginPath(),a.rect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height)}}),u.args=["x","y","width","height","fill","stroke"],["x","y","width","height","x1","x2","y1","y2"].forEach(function(a,b){var c=s.prototype.attrHooks[b>3?"_numAttr":"_num"];u.prototype.attrHooks[a].preAnim=c.preAnim,u.prototype.attrHooks[a].anim=c.anim}),C.rect=function(){return new u(arguments)},C.Rect=u,v=new k(s,{initialize:function(a){this.super("initialize",arguments),g(a[0])&&(a=this.processObject(a[0],v.args)),this.attrs.cx=a[0],this.attrs.cy=a[1],this.attrs.radius=a[2],a[3]&&(this.styles.fillStyle=a[3]),a[4]&&(this.attrs.stroke=a[4],s.processStroke(a[4],this.styles))},attrHooks:new n({cx:{set:function(a){this.update()}},cy:{set:function(a){this.update()}},radius:{set:function(a){this.update()}}}),isPointIn:function(a,b,c){c=("mouse"===c?this.attrs.interactionProps:c)||{};var d=this.isPointInBefore(a,b,c);a=d[0],b=d[1];var e=c.stroke?(this.styles.lineWidth||0)/2:0;return Math.pow(a-this.attrs.cx,2)+Math.pow(b-this.attrs.cy,2)<=Math.pow(this.attrs.radius+e,2)},bounds:function(a,b){return this.super("bounds",[[this.attrs.cx-this.attrs.radius,this.attrs.cy-this.attrs.radius,2*this.attrs.radius,2*this.attrs.radius],a,b])},draw:function(a){this.attrs.visible&&(this.preDraw(a),a.beginPath(),a.arc(this.attrs.cx,this.attrs.cy,Math.abs(this.attrs.radius),0,2*Math.PI,!0),this.postDraw(a))},processPath:function(a){a.beginPath(),a.arc(this.attrs.cx,this.attrs.cy,Math.abs(this.attrs.radius),0,2*Math.PI,!0)}}),v.args=["cx","cy","radius","fill","stroke"],["cx","cy","radius"].forEach(function(a){
v.prototype.attrHooks[a].preAnim=s.prototype.attrHooks._num.preAnim,v.prototype.attrHooks[a].anim=s.prototype.attrHooks._num.anim}),C.circle=function(){return new v(arguments)},C.Circle=v,w=new k({initialize:function(a,b,c){this.method=a,this.path=c,this.attrs={},this.attrs.args=b,w.canvasFunctions[a]&&(this.attrHooks=w.canvasFunctions[a].attrHooks)},attrHooks:o.prototype={args:{set:function(){this.update()}}},attr:k.attr,clone:function(){var a=C.curve(this.method,this.attrs.args);return K(a.attrs,this.attrs),a},startAt:function(){var a=this.path.attrs.d.indexOf(this);return 0===a?[0,0]:this.path.attrs.d[a-1].endAt()},endAt:function(){return w.canvasFunctions[this.method].endAt?w.canvasFunctions[this.method].endAt(this.attrs.args):null},update:function(){return this.path&&this.path.update(),this},bounds:function(a){return w.canvasFunctions[this.method].bounds?(a||(a=this.startAt()),w.canvasFunctions[this.method].bounds(a,this.attrs.args)):null},process:function(a){a[this.method].apply(a,this.attrs.args)}}),w.AttrHooks=o,w.canvasFunctions={moveTo:{attrHooks:p(["x","y"]),endAt:function(a){return a.slice()}},lineTo:{attrHooks:p(["x","y"]),bounds:function(a,b){return[a[0],a[1],b[0],b[1]]},endAt:function(a){return a.slice()}},quadraticCurveTo:{attrHooks:p(["hx","hy","x","y"]),bounds:function(a,b){return[Math.min(a[0],b[0],b[2]),Math.min(a[1],b[1],b[3]),Math.max(a[0],b[0],b[2]),Math.max(a[1],b[1],b[3])]},endAt:function(a){return a.slice(2)}},bezierCurveTo:{attrHooks:p(["h1x","h1y","h2x","h2y","x","y"]),bounds:function(a,b){return[Math.min(a[0],b[0],b[2],b[4]),Math.min(a[1],b[1],b[3],b[5]),Math.max(a[0],b[0],b[2],b[4]),Math.max(a[1],b[1],b[3],b[5])]},endAt:function(a){return a.slice(4)}},arc:{attrHooks:p(["x","y","radius","start","end","clockwise"]),bounds:function(a,b){var c=b[0],d=b[1],e=b[2];b[3],b[4],b[5];return[c-e,d-e,c+e,d+e]},endAt:function(a){var b=a[0],c=a[1],d=a[2],e=a[4]-a[3];return a[5]&&(e=-e),[b+Math.cos(e)*d,c+Math.sin(e)*d]}},arcTo:{attrHooks:p(["x1","y1","x2","y2","radius","clockwise"])}},w.fromArray=function(a,b){return!0===a?closePath:a[0]in C.curves?C.curve(a[0],a.slice(1),b):new w({2:"lineTo",4:"quadraticCurveTo",6:"bezierCurveTo"}[a.length],a,b)},C.curves={moveTo:w,lineTo:w,quadraticCurveTo:w,bezierCurveTo:w,arc:w,arcTo:w,closePath:w},C.Curve=w,C.curve=function(a,b,c){return new C.curves[a](a,b,c)},x=new k(s,{initialize:function(a){this.super("initialize",arguments),g(a[0])&&(a=this.processObject(a[0],x.args)),this.attrs.d=x.parse(a[0],this),isNaN(parseInt(a[1]))&&(a[3]=a[1],a[4]=a[2],a[1]=a[2]=null),(a[1]||a[2])&&(this.attrs.x=a[1]||0,this.attrs.y=a[2]||0),a[3]&&(this.styles.fillStyle=a[3]),a[4]&&(this.attrs.stroke=a[4],s.processStroke(a[4],this.styles))},attrHooks:new n({d:{set:function(a){return this.update(),a}},x:{set:function(a){this.update()}},y:{set:function(a){this.update()}}}),curve:function(a,c){return c===b?this.attrs.d[a]:(isNaN(c[0])||(c=[c]),c=x.parse(c,this,0!==a),this.attrs.d.splice.apply(this.attrs.d,[a,1].concat(c)),this.update())},curves:function(a){return a===b?this.attrs.d:(this.attrs.d=x.parse(a,this,!0),this.update())},before:function(a,b,c){return 0===a&&!1!==turnToLine&&(this.attrs.d[0].method="lineTo"),isNaN(b[0])||(b=[b]),b=x.parse(b,this,0!==a),this.attrs.d.splice.apply(this.attrs.d,[a,0].concat(b)),this.update()},after:function(a,b){return this.before(a+1,b)},remove:function(a){return a===b?this.super("remove"):(this.attrs.d[a].path=null,this.attrs.d.splice(a,1),this.update())},push:function(a,b){return b?this.attrs.d.push(C.curve(a,b,this)):this.attrs.d=this.attrs.d.concat(x.parse(a,this,0!==this.attrs.d.length)),this.update()},each:function(){return this.attrs.d.forEach.apply(this.attrs.d,arguments),this},map:function(){return this.attrs.d.map.apply(this.attrs.d,arguments)},moveTo:function(a,b){return this.push("moveTo",[a,b])},lineTo:function(a,b){return this.push("lineTo",[a,b])},quadraticCurveTo:function(a,b,c,d){return this.push("quadraticCurveTo",[a,b,c,d])},bezierCurveTo:function(a,b,c,d,e,f){return this.push("bezierCurveTo",[a,b,c,d,e,f])},arcTo:function(a,b,c,d,e,f){return this.push("arcTo",[a,b,c,d,e,!!f])},arc:function(a,b,c,d,e,f){return this.push("arc",[a,b,c,d,e,!!f])},closePath:function(){return this.push("closePath",[])},isPointIn:function(a,b,c){var d=this.isPointInBefore(a,b,c);a=d[0],b=d[1];var e=this.context.context;e.save();var f=this.getTransform();C.isIdentityTransform(f)||e.transform(f[0],f[1],f[2],f[3],f[4],f[5]),(this.attrs.x||this.attrs.y)&&e.translate(this.attrs.x||0,this.attrs.y||0),this.attrs.d.forEach(function(a){a.process(e)});var g=e.isPointInPath(a,b);return e.restore(),g},bounds:function(a,b){for(var c,d=1/0,e=1/0,f=-1/0,g=-1/0,h=[0,0],i=0;i<this.attrs.d.length;i++)c=this.attrs.d[i].bounds(h),h=this.attrs.d[i].endAt()||h,c&&(d=Math.min(d,c[0],c[2]),f=Math.max(f,c[0],c[2]),e=Math.min(e,c[1],c[3]),g=Math.max(g,c[1],c[3]));return this.super("bounds",[[d,e,f-d,g-e],a,b])},process:function(a){a.beginPath(),this.attrs.d.forEach(function(b){b.process(a)})},draw:function(a){this.attrs.visible&&(this.preDraw(a),(this.attrs.x||this.attrs.y)&&a.translate(this.attrs.x||0,this.attrs.y||0),this.process(a),this.postDraw(a))}}),x.args=["d","x","y","fill","stroke"],x.parse=function(a,c,d){if(!a)return[];if(a instanceof w)return a.path=c,[a];a[0]===b||+a[0]!==a[0]&&a[0]+""!==a[0]||(a=[a]);var e=[];if(Array.isArray(a))for(var f=0;f<a.length;f++)a[f]instanceof w?(e.push(a[f]),a[f].path=c):0!==f||d?e.push(w.fromArray(a[f],c)):e.push(new w("moveTo",isNaN(a[f][0])?a[f].slice(1):a[f],c));return e},C.path=function(){return new x(arguments)},C.Path=x,y=new k(s,{initialize:function(a){this.super("initialize",arguments),g(a[0])&&(a=this.processObject(a[0],y.args)),this.attrs.image=y.parse(a[0]),this.attrs.x=a[1],this.attrs.y=a[2],this.attrs.width=a[3]===b?"auto":a[3],this.attrs.height=a[4]===b?"auto":a[4],a[5]&&(this.attrs.crop=a[5]),this.attrs.image.addEventListener("load",function(a){this.update(),this.fire("load",a)}.bind(this)),this.attrs.image.addEventListener("error",function(a){this.fire("error",event)}.bind(this))},attrHooks:new n({image:{set:function(a){return a=y.parse(a),a.complete&&this.update(),a.addEventListener("load",function(a){this.update(),this.fire("load",a)}.bind(this)),a}},x:{set:function(a){this.attrs.x=a,this.update()}},y:{set:function(a){this.attrs.y=a,this.update()}},width:{set:function(a){this.attrs.width=a,this.update()}},height:{set:function(a){this.attrs.height=a,this.update()}},crop:{set:function(a){this.attrs.crop=a,this.update()}},smooth:{get:function(){return this.styles[q(this.context.context)]||this.context.context[q(this.context.context)]},set:function(a){this.styles[q(this.context.context)]=!!a,this.update()}}}),remove:function(){this.super("remove"),this.attrs.image.blob&&J.revokeObjectURL(this.attrs.image.blob)},getRealSize:function(){var a=this.attrs.width,b=this.attrs.height;return"auto"===a&&"auto"===b&&(a=b="native"),"auto"===a?a=this.attrs.image.width*(b/this.attrs.image.height):"native"===a&&(a=this.attrs.image.width),"auto"===b?b=this.attrs.image.height*(a/this.attrs.image.width):"native"===b&&(b=this.attrs.image.height),[a,b]},bounds:function(a,b){var c=this.getRealSize();return this.super("bounds",[[this.attrs.x,this.attrs.y,c[0],c[1]],a,b])},isPointIn:function(a,b){var c=this.isPointInBefore(a,b,options);a=c[0],b=c[1];var d=this.getRealSize();return a>this.attrs.x&&b>this.attrs.y&&a<this.attrs.x+d[0]&&b<this.attrs.y+d[1]},draw:function(a){if(this.attrs.visible&&this.attrs.image.complete){this.context.renderer.pre(a,this.styles,this.matrix,this);var b=(this.attrs.image,this.attrs.x,this.attrs.y,this.attrs.width),c=this.attrs.height,d=this.attrs.crop;if("auto"===this.attrs.width||"native"===this.attrs.width||"auto"===this.attrs.height||"native"===this.attrs.height){var e=this.getRealSize();b=e[0],c=e[1]}d?a.drawImage(this.attrs.image,d[0],d[1],d[2],d[3],this.attrs.x,this.attrs.y,b,c):"auto"!==this.attrs.width&&"native"!==this.attrs.width||"auto"!==this.attrs.height&&"native"!==this.attrs.height?a.drawImage(this.attrs.image,this.attrs.x,this.attrs.y,b,c):a.drawImage(this.attrs.image,this.attrs.x,this.attrs.y),a.restore()}}});var S;y.args=["image","x","y","width","height","crop"],y.parse=function(a){if(a+""===a){if("#"===a[0])return D.getElementById(a.substr(1));if("<svg"!==a[0]){var b=new Image;return b.src=a,b}var c=new Blob([a],{type:"image/svg+xml;charset=utf-8"});a=new Image,a.src=J.createObjectURL(c),a.blob=c}return a},C.image=function(){return new y(arguments)},C.Image=y;var T="top";z=new k(s,{initialize:function(a){this.super("initialize",arguments),g(a[0])?(a[0].align&&(this.attrs.align=a[0].align,this.styles.textAlign=a[0].align),a[0].baseline?this.attrs.baseline=a[0].baseline:this.attrs.baseline=T,a[0].breaklines!==b?this.attrs.breaklines=a[0].breaklines:this.attrs.breaklines=!0,a[0].lineHeight!==b?this.attrs.lineHeight=a[0].lineHeight:this.attrs.lineHeight="auto",a[0].maxStringWidth!==b?this.attrs.maxStringWidth=a[0].maxStringWidth:this.attrs.maxStringWidth=1/0,a[0].blockWidth!==b?this.attrs.blockWidth=a[0].blockWidth:this.attrs.blockWidth=1/0,a[0].boundsMode?this.attrs.boundsMode=a[0].boundsMode:this.attrs.boundsMode="inline",a[0].text&&(a[0].text=a[0].text),a=this.processObject(a[0],z.args)):(this.attrs.baseline=T,this.attrs.breaklines=!0,this.attrs.lineHeight="auto",this.attrs.maxStringWidth=1/0,this.attrs.blockWidth=1/0,this.attrs.boundsMode="inline"),this.styles.textBaseline=this.attrs.baseline,this.attrs.text=a[0]+"",this.attrs.x=a[1],this.attrs.y=a[2],this.attrs.font=z.parseFont(a[3]||z.font),this.styles.font=z.genFont(this.attrs.font),a[4]&&(this.styles.fillStyle=a[4]),a[5]&&(this.styles.stroke=a[5],s.processStroke(a[5],this.styles))},attrHooks:new n({text:{set:function(a){return this.lines=null,this.update(),a+""}},x:{set:function(a){this.update()}},y:{set:function(a){this.update()}},font:{set:function(a){return K(this.attrs.font,z.parseFont(a)),this.styles.font=z.genFont(this.attrs.font),this.update(),null}},align:{get:function(){return this.styles.textAlign||"left"},set:function(a){return this.styles.textAlign=a,this.update(),null}},baseline:{get:function(){return this.styles.textBaseline},set:function(a){return this.styles.textBaseline=a,this.update(),null}},breaklines:{set:function(){this.update()}},lineHeight:{set:function(){this.lines=null,this.update()}},maxStringWidth:{set:function(){this.update()}},blockWidth:{set:function(){this.lines=null,this.update()}}}),lines:null,processLines:function(a){var b=this.attrs.text,c=this.lines=[],d="auto"===this.attrs.lineHeight?this.attrs.font.size:this.attrs.lineHeight,e=this.attrs.blockWidth,f=("center"===this.styles.textAlign||this.styles.textAlign,this.context.renderer);return f.preMeasure(this.styles.font),b.split("\n").forEach(function(a){if(f.measure(a)>e){for(var b,g=a.split(" "),h="",i=0;i<g.length;i++)b=h+g[i]+" ",f.measure(b)>e?(c.push({text:h,y:d*c.length}),h=g[i]+" "):h=b;c.push({text:h,y:d*c.length})}else c.push({text:a,y:d*c.length})},this),f.postMeasure(),this},draw:function(a){if(this.attrs.visible){if(this.context.renderer.pre(a,this.styles,this.matrix,this),this.attrs.breaklines){this.lines||this.processLines(a);var c=this.attrs.x,d=this.attrs.y;this.styles.fillStyle&&!this.styles.strokeStyle?this.lines.forEach(function(b){a.fillText(b.text,c,d+b.y)}):this.styles.fillStyle?this.lines.forEach(function(b){a.fillText(b.text,c,d+b.y),a.strokeText(b.text,c,d+b.y)}):this.lines.forEach(function(b){a.strokeText(b.text,c,d+b.y)})}else{var e=this.attrs.maxStringWidth<1/0?this.attrs.maxStringWidth:b;this.styles.fillStyle&&a.fillText(this.attrs.text,this.attrs.x,this.attrs.y,e),this.styles.strokeStyle&&a.strokeText(this.attrs.text,this.attrs.x,this.attrs.y,e)}a.restore()}},isPointIn:function(a,b,c){var d=this.isPointInBefore(a,b,c);a=d[0],b=d[1];var e=this.bounds(!1);return a>e.x1&&b>e.y1&&a<e.x2&&b<e.y2},measure:function(){var a;return this.attrs.breaklines?(this.lines||this.processLines(this.context.context),this.context.renderer.preMeasure(this.styles.font),a=this.lines.reduce(function(a,b){return b=this.context.renderer.measure(b.text),a<b?b:a}.bind(this),0),this.context.renderer.postMeasure()):(this.context.renderer.preMeasure(this.styles.font),a=this.context.renderer.measure(this.attrs.text),this.context.renderer.postMeasure()),a},bounds:function(a,b){var c,d=this.attrs.x,e=this.attrs.y,f="auto"===this.attrs.lineHeight?this.attrs.font.size:this.attrs.lineHeight;this.attrs.breaklines?(c=this.attrs.blockWidth,"inline"!==this.attrs.boundsMode&&isFinite(c)||(c=this.measure()),this.lines||this.processLines(),f*=this.lines.length):(c=this.measure(),this.attrs.maxStringWidth<c&&(c=this.attrs.maxStringWidth));var g=this.styles.textBaseline,h=this.styles.textAlign;return"middle"===g?e-=this.attrs.font.size/2:"bottom"===g||"ideographic"===g?e-=this.attrs.font.size:"alphabetic"===g&&(e-=.8*this.attrs.font.size),"center"===h?d-=c/2:"right"===h&&(d-=c),this.super("bounds",[[d,e,c,f],a,b])}}),z.font="10px sans-serif",z.args=["text","x","y","font","fill","stroke"],z.parseFont=function(a){if(a+""===a){var b={family:""};return a.split(" ").forEach(function(a){"bold"===a?b.bold=!0:"italic"===a?b.italic=!0:I.test(a)?b.size=C.distance(a):b.family+=" "+a}),b.family=b.family.trim(),b}return a},z.genFont=function(a){var b="";return a.italic&&(b+="italic "),a.bold&&(b+="bold "),b+(a.size||10)+"px "+(a.family||"sans-serif")},C.text=function(){return new z(arguments)},C.Text=z,A=new k({initialize:function(a,b,c,d,e){if(this.context=e,a+""!==a&&(d=c,c=b,b=a,a="linear"),!A.types[a])throw'Unknown gradient type "'+a+'"';this.type=a,this.attrs={from:c,to:d,colors:A.parseColors(b)},this.binds=[],A.types[this.type]&&(this.attrHooks=K(K({},this.attrHooks),A.types[this.type].attrHooks),A.types[this.type].initialize&&A.types[this.type].initialize.call(this))},attr:k.attr,attrHooks:{colors:{set:function(a){return this.update(),A.parseColors(a)}}},color:function(a,c){if(c!==b)return this.attrs.colors[a]=c,this.update();if(this.attrs.colors[a])return C.color(this.attrs.colors[a]);var d=this.attrs.colors,e=Object.keys(d).sort();if(a<e[0])return C.color(d[e[0]]);if(a>e[e.length-1])return C.color(d[e[e.length-1]]);for(var f=0;f<e.length;f++)if(+e[f]>a){var g=C.color(d[e[f-1]]),h=C.color(d[e[f]]);return a=(a-+e[f-1])/(+e[f]-+e[f-1]),[g[0]+(h[0]-g[0])*a+.5|0,g[1]+(h[1]-g[1])*a+.5|0,g[2]+(h[2]-g[2])*a+.5|0,+(g[3]+(h[3]-g[3])*a).toFixed(2)]}},update:function(){return this.context.update(),this},toCanvasStyle:function(a,b){return A.types[this.type].toCanvasStyle.call(this,a,b)}}),A.parseColors=function(a){if(!Array.isArray(a))return a;var b={},c=1/(a.length-1);return a.forEach(function(a,d){b[c*d]=a}),b},A.types={linear:{attrHooks:{from:{set:function(a){return this.update(),a}},to:{set:function(a){return this.update(),a}}},toCanvasStyle:function(a,b){return this.context.renderer.makeGradient(this.context,"linear",b.corner(this.attrs.from),b.corner(this.attrs.to),this.attrs.colors)}},radial:{initialize:function(){this.attrs.from&&Array.isArray(this.attrs.from)?(this.attrs.startRadius=this.attrs.from[2]||0,this.attrs.from=this.attrs.from.slice(0,2)):(this.attrs.from||(this.attrs.from="center"),this.attrs.startRadius=0),this.attrs.to&&Array.isArray(this.attrs.to)?(this.attrs.radius=this.attrs.to[2]||"auto",this.attrs.to=this.attrs.to.slice(0,2)):(this.attrs.to||(this.attrs.to=this.attrs.from),this.attrs.radius="auto")},attrHooks:{from:{set:function(a){return Array.isArray(a)&&a.length>2&&(this.attrs.startRadius=a[2],a=a.slice(0,2)),this.update(),a}},to:{set:function(a){return Array.isArray(a)&&a.length>2&&(this.attrs.radius=a[2],a=a.slice(0,2)),this.update(),a}},radius:{set:function(a){return this.update(),a}},startRadius:{set:function(a){return this.update(),a}}},toCanvasStyle:function(a,b){var c=b.corner(this.attrs.from),d=b.corner(this.attrs.to);return this.context.renderer.makeGradient(this.context,"radial",[c[0],c[1],this.attrs.startRadius],[d[0],d[1],"auto"===this.attrs.radius?b.bounds().height:this.attrs.radius],this.attrs.colors)}}},C.Gradient=A,B=new k({initialize:function(a,b,c){this.image=y.parse(a),this.repeat=b,this.context=c,this.image.addEventListener("load",function(a){this.update(),this.image.blob&&J.revokeObjectURL(blob)}.bind(this))},update:function(){return this.context.update(),this},toCanvasStyle:function(a){return this.image.complete?a.createPattern(this.image,this.repeat||"repeat"):"transparent"}}),C.Pattern=B,C.version="1.9.0",C.query=function(a,b,c,d){return a+""===a&&(a=(d||D).querySelectorAll(a)[c||0]),new C.contexts[b||"2d"](a.canvas||a)},C.id=function(a,b){return new C.contexts[b||"2d"](D.getElementById(a))},"object"==typeof module&&"object"==typeof module.exports?module.exports=C:"function"==typeof define&&define.amd?define("Delta",[],function(){return C}):a&&(a.Delta=C)}("undefined"!=typeof window?window:this);