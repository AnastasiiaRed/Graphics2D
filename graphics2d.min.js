!function(i,o){var n,a,r,e,h,u,c,t,l,s,f={},d=i.document,p=Object.prototype.toString,m=Array.prototype.slice,g=Function.prototype.call.bind(Object.prototype.hasOwnProperty),y=/^\d*\.\d+$/,b=/^(\d+|(\d+)?\.\d+)(em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|px|pt|pc)?$/,v=i.URL||i.webkitURL||i,x=Object.assign?Object.assign:function(t,e){for(var s=Object.keys(e),i=s.length;i--;)t[s[i]]=e[s[i]];return t},w={mouse:["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","mousewheel","blur","focus"],touch:["touchstart","touchmove","touchend","touchcancel"],pointer:["pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"],keyboard:["keypress","keydown","keyup"]},k=i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(t){return i.setTimeout(t,1e3/60)};i.cancelAnimationFrame||i.webkitCancelAnimationFrame||i.mozCancelAnimationFrame||i.oCancelAnimationFrame||i.msCancelAnimationFrame||i.cancelRequestAnimationFrame||i.webkitCancelRequestAnimationFrame||i.mozCancelRequestAnimationFrame||i.oCancelRequestAnimationFrame||i.msCancelRequestAnimationFrame||i.clearTimeout;function O(t,e,s,i){s<0&&(t-=s=-s),i<0&&(e-=i=-i),this.x=this.x1=t,this.y=this.y1=e,this.w=this.width=s,this.h=this.height=i,this.x2=t+s,this.y2=e+i,this.cx=t+s/2,this.cy=e+i/2}function A(t,e){var s=t[e];return t=m.call(t,e+1),function(){this[s].apply(this,t)}}function T(t){return"[object Object]"===p.call(t)}function C(t){return+t===t||t+""===t&&b.test(t)}f.renderers={},f.bounds=function(t,e,s,i){return new O(t,e,s,i)},f.Class=H,f.Bounds=O,f.extend=x,f.argument=function(e){return function(t){return this.argument(e,t)}},f.wrap=A,f.isObject=T,f.isNumberLike=C,f.isPatternLike=function(t){return t instanceof Image||T(t)&&g(t,"image")||t+""===t&&!(t.indexOf("http://")&&t.indexOf("https://")&&t.indexOf("./")&&t.indexOf("../")&&t.indexOf("data:image/")&&t.indexOf("<svg"))},f.dashes={shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},f.fileTypes={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",webp:"image/webp"},f.corners={left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],center:[.5,.5],"left top":[0,0],"top left":[0,0],"left bottom":[0,1],"bottom left":[0,1],"right top":[1,0],"top right":[1,0],"right bottom":[1,1],"bottom right":[1,1],lt:[0,0],tl:[0,0],lb:[0,1],bl:[0,1],rt:[1,0],tr:[1,0],rb:[1,1],br:[1,1]},f.colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",chucknorris:"c00000",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},f.coordsOfElement=function(t){var e=t.getBoundingClientRect(),s=i.getComputedStyle(t);return{x:e.left+parseInt(s.borderLeftWidth||0)+parseInt(s.paddingLeft||0),y:e.top+parseInt(s.borderTopWidth||0)+parseInt(s.paddingTop||0)}},f.clone=function(t){var e=new t.constructor;for(var s in t)g(t,s)&&("object"!=typeof t[s]||t[s]instanceof E||t[s]instanceof Image?e[s]=t[s]:e[s]=f.clone(t[s]));return e},f.parseTransform=function(e,i){if(Array.isArray(e.transform))return e.transform;var r=[1,0,0,1,0,0];"attributes"===e.transform?(e.transformOrder||"translate rotate scale skew").split(" ").forEach(function(t){e[t]!==o&&(r=f.transforms[t](r,e[t],i))}):e.transform.split(")").forEach(function(t){if(""!==(t=t.trim())){var e=t.match(/[a-z]+/),s=t.split("(")[1].split(",").map(function(t){return t.trim()});r=f.transforms[e](r,s,i)}});return r},f.transforms={translate:function(t,e){return t[4]+=+e[0],t[5]+=+e[1],t},scale:function(t,e,s){+e===e?e=[e,e]:+e[1]!==e[1]&&(e=[e[0],e[0],e[1]]);var i=s.corner(e[2]||"center");return t=f.transform(t,[1,0,0,1,i[0],i[1]]),t=f.transform(t,[e[0],0,0,e[1],0,0]),t=f.transform(t,[1,0,0,1,-i[0],-i[1]])},skew:function(t,e,s){+e===e?e=[e,e]:+e[1]!==e[1]&&(e=[e[0],e[0],e[1]]),e[0]=+e[0]/180*Math.PI,e[1]=+e[1]/180*Math.PI;var i=s.corner(e[2]||"center");return t=f.transform(t,[1,0,0,1,i[0],i[1]]),t=f.transform(t,[1,Math.tan(e[1]),Math.tan(e[0]),1,0,0]),t=f.transform(t,[1,0,0,1,-i[0],-i[1]])},rotate:function(t,e,s){+e===e&&(e=[e]),e[0]=+e[0]/180*Math.PI;var i=s.corner(e[1]||"center");return t=f.transform(t,[1,0,0,1,i[0],i[1]]),t=f.transform(t,[Math.cos(e[0]),Math.sin(e[0]),-Math.sin(e[0]),Math.cos(e[0]),0,0]),t=f.transform(t,[1,0,0,1,-i[0],-i[1]])}},f.isIdentityTransform=function(t){return 0===t[5]&&0===t[4]&&1===t[3]&&0===t[2]&&0===t[1]&&1===t[0]},f.transform=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},f.transformPoint=function(t,e){return[t[0]*e[0]+t[2]*e[1]+t[4],t[1]*e[0]+t[3]*e[1]+t[5]]},f.inverseTransform=function(t){var e=t[0]*t[3]-t[2]*t[1];return 0===e?null:[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,-(t[3]*t[4]-t[2]*t[5])/e,(t[1]*t[4]-t[0]*t[5])/e]},f.color=function(t){if(t!==o){if(Array.isArray(t))return t.slice(0,4);if(t+""!==t)throw"Not a color: "+t.toString();if(0!==t.indexOf("rgb"))return"#"===t[0]?(3===(t=t.substring(1)).length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16),1]):t in f.colors?f.color("#"+f.colors[t]):"rand"===t?[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),1]:[0,0,0,0];var e=(t=t.substring(t.indexOf("(")+1,t.length-1).replace(/\s/g,"").split(","))[3];return t=t.slice(0,3).map(function(t,e){return 0<t.indexOf("%")?Math.round(2.55*parseInt(t)):parseInt(t)}),e===o&&(e=1),t.push(Number(e)),t}},f.angleUnit="grad",f.unit="px";var E,M="pt em in cm mm pc ex ch rem v wvh vmin vmax".split(" "),P={px:1,ch:8,cm:37.78125,em:16,ex:7.15625,in:96,mm:3.765625,pc:16,pt:1.328125,rem:16,v:16,vmax:13.65625,vmin:4.78125,wvh:16};function H(r,t){t||(t=r,r=null);var e=function(){return this.initialize&&this.initialize.apply(this,arguments)};if(r){var s=function(){};s.prototype=r.prototype,(e.prototype=new s).superclass=r.prototype,(e.prototype.constructor=e).prototype.super=function(t,e){if(!this.superclass.superclass||!this.superclass.superclass[t])return this.superclass[t].apply(this,e);var s=this.superclass;this.superclass=this.superclass.superclass;var i=s[t].apply(this,e);return this.superclass=r.prototype,i}}return t.mixins&&t.mixins.forEach(function(t){x(e.prototype,H.mixins[t])}),x(e.prototype,t),e}f.snapToPixels=1,f.distance=function(t,e){if(t!==o){if(!t)return 0;if(f.snapToPixels&&!e)return Math.round(f.distance(t,!0)/f.snapToPixels)*f.snapToPixels;if(+t===t)return"px"!==f.unit?f.distance(t+""+f.unit):t;if((t+="").indexOf("px")===t.length-2)return parseInt(t);if(!f.units)if(d){var s=d.createElement("div");d.body.appendChild(s),f.units={},M.forEach(function(t){s.style.width="1"+t,f.units[t]=parseFloat(getComputedStyle(s).width)}),d.body.removeChild(s)}else f.units=P;var i=t.replace(/[\d\.]+?/g,"");return t=t.replace(/[^\d\.]+?/g,""),""===i?t:1===f.snapToPixels?Math.round(f.units[i]*t):f.units[i]*t}},H.mixins={AttrMixin:{attrs:{},attrHooks:{},attr:function(e,t){return e.constructor===Array?e.map(function(t){return this.attrs[t]},this):"string"!=typeof e?(Object.keys(e).forEach(function(t){this.attr(t,e[t])},this),this):1===arguments.length?this.attrs[e]:(this.attrs[e]=val,this)}},EventMixin:{listeners:{},eventHooks:{},on:function(e,t,s){return e.constructor!==String?Object.keys(e).forEach(function(t){this.on(t,e[t])},this):(t&&(t.constructor===Function?(s=t,t=null):t.constructor===String&&Array.prototype.splice.call(arguments,1,0,null)),s.constructor===String&&(r=(i=arguments)[2],s=function(){return this[r].apply(this,Array.prototype.slice.call(i,3))}),this.listeners[e]||(this.listeners[e]=[],this.eventHooks[e]&&this.eventHooks[e].init&&this.eventHooks[e].init.call(this,e)),this.listeners[e].push({callback:s,options:t})),this;var i,r},off:function(t,e){var s=this.listeners[t],i=this.eventHooks[t];if(s)if(e){for(var r=0;r<s.length;r++)if(s[r].callback===e){s.splice(r,1);break}i&&!s.length&&i.teardown&&(this.listeners[t]=null,i.teardown.call(this,t))}else this.listeners[t]=null,i&&i.teardown&&i.teardown.call(this,t);return this},fire:function(t,e,s){var i=this.listeners[t];return i&&(s&&(i=i.filter(s,this)),i.forEach(function(t){t.callback.call(this,e)},this)),this}},LinkMixin:{links:[],pushLink:function(){},callLinks:function(t){}}},(E=function(t){this.canvas=t,this.context=t.getContext("2d"),this.elements=[],this.listeners={},this.attrs={transform:"attributes"},this.cache={},this.updateNow=this.updateNow.bind(this)}).prototype={object:function(t){return t.constructor===Function&&(t={draw:t}),this.push(x(new n,t))},rect:function(){return this.push(new r(arguments))},circle:function(){return this.push(new e(arguments))},path:function(){return this.push(new u(arguments))},image:function(){return this.push(new c(arguments))},text:function(){return this.push(new t(arguments))},line:function(t,e,s,i,r){return this.path([[t,e],[s,i]],null,r)},quadratic:function(t,e,s,i,r,n,a){return this.path([[t,e],[s,i,r,n]],null,a)},bezier:function(t,e,s,i,r,n,a,o,h){return this.path([[t,e],[s,i,r,n,a,o]],null,h)},arcTo:function(t,e,s,i,r,n,a){return this.path([[t,e],["arcTo",t,e,s,i,r,n]],null,a)},useCache:!(H.attr=function(e,t){if(Array.isArray(e))return e.map(function(t){return this.attr(t)},this);if(e+""!==e)return Object.keys(e).forEach(function(t){this.attr(t,e[t])},this),this;if(1===arguments.length)return this.attrHooks[e]&&this.attrHooks[e].get?this.attrHooks[e].get.call(this):this.attrs[e];if(this.attrHooks[e]&&this.attrHooks[e].set){var s=this.attrHooks[e].set.call(this,t);null!==s&&(this.attrs[e]=s===o?t:s)}else this.attrs[e]=t;return this}),gradient:function(t,e,s,i){return new l(t,e,s,i,this)},pattern:function(t,e){return new s(t,e,this)},push:function(t){if((t.context=this).elements.push(t),t.draw){var e=this.context;e.save(),this.matrix?e.setTransform(this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5]):e.setTransform(1,0,0,1,0,0),t.draw(e),e.restore()}return t.update=t.updateFunction,t},update:function(){this._willUpdate||(this._willUpdate=!0,k(this.updateNow))},updateNow:function(){var e=this.context;e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height);var t=this.getTransform(),s=this.attrs.dpi||1;f.isIdentityTransform(t)?1!==s&&e.setTransform(s,0,0,s,0,0):e.setTransform(t[0]/s,t[1],t[2],t[3]/s,t[4],t[5]),this.elements.forEach(function(t){t.draw(e)}),e.restore(),this._willUpdate=!1},getObjectInPoint:function(t,e,s){for(var i=this.elements,r=i.length;r--;)if(i[r].isPointIn&&(i[r].attrs.interaction||!s)&&i[r].isPointIn(t,e,"mouse"))return i[r];return null},each:function(t){if(t+""===t){var e=m.call(arguments,1),s=t;t=function(t){t[s].apply(t,e)}}return this.elements.slice().forEach(t,this),this},contextCoords:function(t,e){var s=f.coordsOfElement(this.canvas);return[t-s.x,e-s.y]},attr:H.attr,attrHooks:{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t,this.canvas.style.width=this.canvas.width/(this.attrs.dpi||1)+"px",this.update()}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t,this.canvas.style.height=this.canvas.height/(this.attrs.dpi||1)+"px",this.update()}},dpi:{get:function(){return this.attrs.dpi||1},set:function(t){this.canvas.style.width=this.canvas.width/t+"px",this.canvas.style.height=this.canvas.height/t+"px",this.update()}},smooth:{get:function(t){var e=this.canvas.style.imageRendering;return"pixelated"!==e&&"crisp-edges"!==e},set:function(t){this.canvas.style.imageRendering=t?"initial":"pixelated"}},transform:{set:function(t){this.cache.transform=null,this.update()}},translate:{get:function(){return this.attrs.translate||[0,0]},set:function(t){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},rotate:{get:function(){return this.attrs.rotate||0},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},scale:{get:function(){return this.attrs.scale||[1,1]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},skew:{get:function(){return this.attrs.skew||[0,0]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}}},getTransform:function(){if(this.cache.transform)return this.cache.transform;var t=f.parseTransform(this.attrs,this);return this.cache.transform=t},corner:function(t){return[this.canvas.width*f.corners[t][0],this.canvas.height*f.corners[t][1]]}},Object.assign(E.prototype,H.mixins.EventMixin,{hoverElement:null,focusElement:null,listeners:{},eventHooks:{}}),f.browserCommonEvent={init:function(t){this.canvas&&this.eventHooks[t].canvas&&this.canvas.addEventListener(t,this.listeners[t+"__canvasListener"]=this.eventHooks[t].canvas.bind(this))},teardown:function(t){this.canvas&&k(function(){this.listeners[t]||this.canvas.removeEventListener(t,this.listeners[t+"__canvasListener"])}.bind(this))},canvas:function(t){t.cancelContextPropagation=function(){},this.fire(t.type,t)}},f.browserMouseEvent=Object.assign({},f.browserCommonEvent,{canvas:function(t){var e=!0;t.cancelContextPropagation=function(){e=!1};var s=this.contextCoords(t.clientX,t.clientY);t.contextX=s[0],t.contextY=s[1],this.hoverElement=t.targetObject=this.getObjectInPoint(t.contextX,t.contextY,!0),t.targetObject&&t.targetObject.fire&&t.targetObject.fire(t.type,t),e&&this.fire(t.type,t)}}),f.browserTouchEvent=Object.assign({},f.browserCommonEvent,{canvas:function(e){var t=!0;e.cancelContextPropagation=function(){t=!1},["touches","changedTouches","targetTouches"].forEach(function(t){e[t]&&Array.prototype.forEach.call(e[t],function(t){var e=this.contextCoords(t.clientX,t.clientY);t.contextX=e[0],t.contextY=e[1],t.targetObject=this.getObjectInPoint(t.contextX,t.contextY,!0)},this)},this),Array.prototype.forEach.call(e.touches,function(t){t.targetObject&&t.targetObject.fire&&e.targetObject.fire(e.type,e)},this),t&&this.fire(e.type,e)}});var j,q,I=i.document?{mouse:f.browserMouseEvent,touch:f.browserTouchEvent,pointer:f.browserCommonEvent,keyboard:f.browserCommonEvent}:{};function S(t,e){return j||(j=d.createElement("canvas")),j.width=t,j.height=e,j}function z(t){x(this,t)}function F(){this.update()}function n(t){this.listeners={},this.styles={},this.cache={},this.attrs={interaction:!0,visible:!0,transform:"attributes"},this.argsOrder&&this.processArguments(t,this.argsOrder)}function R(t){x(this,t)}function L(t){for(var e=new R({}),s=0;s<t.length;s++);return e}function D(e){return["mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled"].forEach(function(t){t in e&&(q=t)}),D=function(){return q},q}Object.keys(w).forEach(function(t){w[t].forEach(function(e){E.prototype.eventHooks[e]=I[t],E.prototype[e]=function(t){return t.constructor===Function?this.on(e,t):t.constructor===String?this.on.apply(this,[e].concat(m.call(arguments))):this.fire(t)}})}),E.prototype.eventHooks.mouseout=Object.assign({},f.browserCommonEvent,{init:function(){f.browserCommonEvent.init.call(this,"mouseout"),f.browserCommonEvent.init.call(this,"mousemove")},canvas:function(t){var e=!0;t.cancelContextPropagation=function(){e=!1},t.targetObject=this.hoverElement,this.hoverElement=null;var s=this.contextCoords(t.clientX,t.clientY);t.contextX=s[0],t.contextY=s[1],t.targetObject&&t.targetObject.fire&&t.targetObject.fire("mouseout",t),e&&this.fire("mouseout",t)},teardown:function(){f.browserCommonEvent.teardown.call(this,"mouseout"),f.browserCommonEvent.teardown.call(this,"mousemove")}}),f.Context=E,f.contexts={"2d":E},n.prototype={initialize:n,updateFunction:function(){return this.context&&this.context.update(),this},update:function(){return this},clone:function(t,e,s){var i=new this.constructor([],this.context);return i.attrs=!1===t?this.attrs:x({},this.attrs),!1===e?(i.styles=this.styles,i.matrix=this.matrix):(i.styles=x({},this.styles),this.matrix&&(i.matrix=this.matrix.slice())),i.listeners=!1===s?this.listeners:x({},this.listeners),this.context.push(i)},remove:function(){return this.context.elements.splice(this.context.elements.indexOf(this),1),this.update(),this.context=null,this},attr:H.attr,attrHooks:z.prototype={z:{get:function(){return this.context.elements.indexOf(this)},set:function(t){var e=this.context.elements;"top"===t&&(t=e.length),e.splice(this.context.elements.indexOf(this),1),e.splice(t,0,this),this.update()}},visible:{set:function(){this.update()}},fill:{get:function(){return this.styles.fillStyle},set:function(t){this.styles.fillStyle=t,this.update()}},stroke:{set:function(t){n.processStroke(t,this.styles),this.update()}},strokeMode:{get:function(){return this.attrs.strokeMode||"over"},set:function(t){this.update()}},shadow:{set:function(t){n.processShadow(t,this.styles),this.update()}},opacity:{get:function(){return this.styles.globalAlpha!==o?this.styles.globalAlpha:1},set:function(t){this.styles.globalAlpha=+t,this.update()}},composite:{get:function(){return this.styles.globalCompositeOperation},set:function(t){this.styles.globalCompositeOperation=t,this.update()}},clip:{set:function(t){t.context=this.context,this.attrs.clip=t,this.update()}},cursor:{set:function(t){}},transform:{set:function(t){this.cache.transform=null,this.update()}},translate:{get:function(){return this.attrs.translate||[0,0]},set:function(t){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},rotate:{get:function(){return this.attrs.rotate||0},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},scale:{get:function(){return this.attrs.scale||[1,1]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}},skew:{get:function(){return this.attrs.skew||[0,0]},set:function(){"attributes"===this.attrs.transform&&(this.cache.transform=null,this.update())}}},getTransform:function(){if(this.cache.transform)return this.cache.transform;var t=f.parseTransform(this.attrs,this);return this.cache.transform=t},processObject:function(e,t){return["opacity","composite","clip","visible","interaction","shadow","z","transform","transformOrder","rotate","skew","scale"].forEach(function(t){e[t]!==o&&this.attr(t,e[t])},this),t.map(function(t){return e[t]})},processArguments:function(s,t){if(s[0].constructor===Object)this.attr(s);else{var i={};t.forEach(function(t,e){s[e]!==o&&(i[t]=s[e])},this),this.attr(i)}},isPointInBefore:function(t,e,s){if(s&&!1!==s.transform){var i=this.getTransform();if(!f.isIdentityTransform(i)){var r=f.inverseTransform(i);return f.transformPoint(r,[t,e])}}return[t,e,s]},bounds:function(t,e,s){if(("fill"===s||!s)&&this.styles.strokeStyle){var i=(this.styles.lineWidth||1)/2;"strokeExclude"===s&&(i=-i),t[0]-=i,t[1]-=i,t[2]+=2*i,t[3]+=2*i}if(!1!==e&&this.matrix){var r=[f.transformPoint(this.matrix,[t[0],t[1]]),f.transformPoint(this.matrix,[t[0]+t[2],t[1]]),f.transformPoint(this.matrix,[t[0],t[1]+t[3]]),f.transformPoint(this.matrix,[t[0]+t[2],t[1]+t[3]])];if("tight"===e)return r;t[0]=Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),t[1]=Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),t[2]=Math.max(r[0][0],r[1][0],r[2][0],r[3][0])-t[0],t[3]=Math.max(r[0][1],r[1][1],r[2][1],r[3][1])-t[1]}return new O(t[0],t[1],t[2],t[3])},corner:function(t,e){return Array.isArray(t)?t:[(e=e instanceof O?e:this.bounds(e)).x+e.w*f.corners[t][0],e.y+e.h*f.corners[t][1]]},on:function(t,e,s){if(t+""!==t)for(var i in t)g(t,i)&&this.on(i,t[i]);return"function"==typeof e?(s=e,e=null):e+""===e&&Array.prototype.splice.call(arguments,1,0,null),s+""===s&&(s=A(arguments,2)),this.context.listener(t),(this.listeners[t]||(this.listeners[t]=[])).push(s),this},off:function(t,e){return t?e?this.listeners[t].splice(this.listeners[t].indexOf(e),1):this.listeners[t]=null:this.listeners={},this},fire:function(t,e,s){if(!this.listeners[t])return this;var i=this.listeners[t];return s&&(i=i.filter(s,this)),i.forEach(function(t){t.call(this,e)},this),this},preDraw:function(e){e.save();var s=this.styles;Object.keys(s).forEach(function(t){e[t]=s[t]}),s.fillStyle&&s.fillStyle.toCanvasStyle&&(e.fillStyle=s.fillStyle.toCanvasStyle(e,object)),s.strokeStyle&&s.strokeStyle.toCanvasStyle&&(e.strokeStyle=s.strokeStyle.toCanvasStyle(e,object)),s.lineDash&&(e.setLineDash?e.setLineDash(s.lineDash):e.mozDash=s.lineDash),this.attrs.clip&&(this.attrs.clip.matrix?(e.save(),e.transform.apply(e,this.attrs.clip.matrix),this.attrs.clip.processPath(e),e.restore()):this.attrs.clip.processPath(e),e.clip());var t=this.getTransform();f.isIdentityTransform(t)||e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},postDraw:function(t){var e=this.styles;e.fillStyle&&t.fill(this.attrs.fillRule),e.strokeStyle&&t.stroke(),t.restore()},toDataURL:function(t,e){if(e===o){if("function"!=typeof this.bounds)throw"Object #"+this.attr("z")+" can't be rasterized: need the bounds.";e=this.bounds()}t===o?t="image/png":t in f.fileTypes&&(t=f.fileTypes[t]);var s=S(e.width,e.height),i=s.getContext("2d");return i.setTransform(1,0,0,1,-e.x,-e.y),this.draw(i),s.toDataURL(t.type||t,t.quality||1)},toBlob:function(t,e,s,i){},toImageData:function(t){if(t===o){if("function"!=typeof this.bounds)throw"Object #"+this.z()+" can't be rasterized: need the bounds.";t=this.bounds()}var e=S(t.width,t.height).getContext("2d");return e.setTransform(1,0,0,1,-t.x,-t.y),this.draw(e),e.getImageData(0,0,t.width,t.height)},animate:function(s,t,i){if(s+""!==s)return i=+t!==t&&t?"function"==typeof t?{callback:t}:t:{duration:t,easing:i,callback:arguments[3]},Object.keys(s).forEach(function(t,e){this.animate(t,s[t],i),0===e&&(i.queue=!1,i.callback=null)},this),this;if(!this.attrHooks[s]||!this.attrHooks[s].anim)throw'Animation for "'+s+'" is not supported';+i!==i&&i?"function"==typeof i&&(i={callback:i}):i={duration:i,callback:arguments[4],easing:arguments[3]};var e=new a(i.duration,i.easing,i.callback);e.prop=s,e.tick=this.attrHooks[s].anim,e.tickContext=this,e.prePlay=function(){this.fx=e,this.attrHooks[s].preAnim.call(this,e,t)}.bind(this),e.elem=this,i.name&&(e.name=i.name);var r=i.queue;return!1!==r&&(!0===r||r===o?(this._queue||(this._queue=[]),r=this._queue):r instanceof n&&(r=r._queue),(e.queue=r).push(e),1<r.length)||e.play(),this},pause:function(e){return this._paused||(this._paused=[]),a.queue.slice().forEach(function(t){t.elem!==this||t.name!==e&&e||(t.pause(),this._paused.push(t))},this),this},continue:function(s){if(this._paused)return this._paused.slice().forEach(function(t,e){s&&t.name!==s||(t.continue(),this._paused.splice(e,1))},this),this}},n.AttrHooks=z,n.processStroke=function(t,e){if(t+""===t){for(var s,i=(t=t.replace(/\s*\,\s*/g,",").split(" ")).length,r=!1,n=!1;i--;)y.test(t[i])?s=parseFloat(t[i]):C(t[i])?e.lineWidth=f.distance(t[i]):"round"===t[i]?(r||(e.lineJoin="round"),n||(e.lineCap=e.lineCap||"round")):"miter"===t[i]||"bevel"===t[i]?(r=!0,e.lineJoin=t[i]):"butt"===t[i]||"square"===t[i]?(n=!0,e.lineCap=t[i]):"["===t[i][0]?e.lineDash=t[i].substr(1,t[i].length-2).split(","):t[i]in f.dashes?e.lineDash=f.dashes[t[i]]:t[i].lastIndexOf("ml")===t[i].length-2?e.miterLimit=+t[i].slice(0,t[i].length-2):0===t[i].indexOf("do")?e.lineDashOffset=f.distance(t[i].slice(2)):e.strokeStyle=t[i];s&&((t=f.color(e.strokeStyle))[3]=s,e.strokeStyle="rgba("+t.join(",")+")")}else{if(t.color!==o&&(e.strokeStyle=t.color),t.opacity!==o&&e.strokeStyle){var a=f.color(e.strokeStyle);a[3]=t.opacity,e.strokeStyle="rgba("+a.join(",")+")"}t.width!==o&&(e.lineWidth=f.distance(t.width)),t.join!==o&&(e.lineJoin=t.join),t.cap!==o&&(e.lineCap=t.cap),t.miterLimit!==o&&(e.miterLimit=t.miterLimit),t.dash!==o&&(t.dash in f.dashes?e.lineDash=f.dashes[t.dash]:e.lineDash=t.dash),t.dashOffset!==o&&(e.lineDashOffset=f.distance(t.dashOffset))}},n.processShadow=function(t,e){if(t+""===t){var s=["shadowOffsetX","shadowOffsetY","shadowBlur"];t=t.replace(/\s*\,\s*/g,",").split(" ");for(var i=0;i<t.length;i++)isNaN(+t[i][0])?e.shadowColor=t[i]:e[s.shift()]=f.distance(t[i])}else t.x!==o&&(e.shadowOffsetX=f.distance(t.x)),t.y!==o&&(e.shadowOffsetY=f.distance(t.y)),t.blur!==o&&(e.shadowBlur=f.distance(t.blur||0)),t.color&&(e.shadowColor=t.color)},f.Drawable=n,["keypress","keydown","keyup"].forEach(function(t){n.prototype[t]=E.prototype[t]}),(a=new H({initialize:function(t,e,s){this.duration=t||a.default.duration,this.easing=e+""===e?(-1<e.indexOf("(")&&(this.easingParam=+e.split("(")[1].split(")")[0],e=e.split("(")[0]),a.easing[e]):e||a.easing.default,this.callback=s},play:function(t,e){this.prePlay&&this.prePlay(),t&&(this.tick=t),e&&(this.tickContext=e),this.startTime=Date.now(),this.endTime=this.startTime+this.duration,a.queue.length||k(a.do),a.queue.push(this)},pause:function(){this.pauseTime=Date.now(),a.queue.splice(a.queue.indexOf(this),1)},continue:function(){var t=this.pauseTime-this.startTime;this.startTime=Date.now()-t,this.endTime=this.startTime+this.duration,a.queue.length||k(a.do),a.queue.push(this)}})).queue=[],a.do=function(){for(var t,e,s=Date.now(),i=0;i<a.queue.length;i++)(e=(s-(t=a.queue[i]).startTime)/t.duration)<0||(1<e&&(e=1),t.now=s,t.pos=t.easing(e,t.easingParam),t.tick.call(t.tickContext,t),1===e&&(t.callback&&t.callback.call(t.tickContext,t),t.queue&&(t.queue.shift(),t.queue.length&&t.queue[0].play()),a.queue.splice(a.queue.indexOf(t),1)));a.queue.length&&k(a.do)},n.prototype.attrHooks._num={preAnim:function(t,e){t.startValue=this.attr(t.prop),t.delta=e-t.startValue,e+""===e&&(0===e.indexOf("+=")?t.delta=+e.substr(2):0===e.indexOf("-=")&&(t.delta=-e.substr(2)))},anim:function(t){this.attrs[t.prop]=t.startValue+t.delta*t.pos,this.update()}},n.prototype.attrHooks._numAttr={preAnim:n.prototype.attrHooks._num.preAnim,anim:function(t){this.attr(t.prop,t.startValue+t.delta*t.pos)}},a.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},sqrt:function(t){return Math.sqrt(t)},pow:function(t,e){return Math.pow(t,e||6)},expo:function(t,e){return Math.pow(e||2,8*t-8)},circ:function(t){return 1-Math.sin(Math.acos(t))},sine:function(t){return 1-Math.cos(t*Math.PI/2)},back:function(t,e){return Math.pow(t,2)*((e||1.618)*(t-1)+t)},bounce:function(t){for(var e=0,s=1;;e+=s,s/=2)if((7-4*e)/11<=t)return s*s-Math.pow((11-6*e-11*t)/4,2)},elastic:function(t,e){return Math.pow(2,10*--t)*Math.cos(20*t*Math.PI*(e||1)/3)},bezier:function(t,e){}},a.easing.default=a.easing.swing,["quad","cubic","quart","quint"].forEach(function(t,e){a.easing[t]=function(t){return Math.pow(t,e+2)}}),Object.keys(a.easing).forEach(function(s){a.easing[s+"In"]=a.easing[s],a.easing[s+"Out"]=function(t,e){return 1-a.easing[s](1-t,e)},a.easing[s+"InOut"]=function(t,e){return.5<=t?a.easing[s](2*t,e)/2:(2-a.easing[s](2*(1-t),e))/2}}),a.default={duration:500},f.animation=function(t,e,s){return new a(t,e,s)},r=new H(n,{argsOrder:["x","y","width","height","fill","stroke"],attrHooks:new z({x:{set:F},y:{set:F},width:{set:F},height:{set:F},x1:{get:function(){return this.attrs.x},set:function(t){return this.attrs.width+=this.attrs.x-t,this.attrs.x=t,this.update(),null}},y1:{get:function(){return this.attrs.y},set:function(t){return this.attrs.height+=this.attrs.y-t,this.attrs.y=t,this.update(),null}},x2:{get:function(){return this.attrs.x+this.attrs.width},set:function(t){return this.attrs.width=t-this.attrs.x,this.update(),null}},y2:{get:function(){return this.attrs.y+this.attrs.height},set:function(t){return this.attrs.height=t-this.attrs.y,this.update(),null}}}),isPointIn:function(t,e,s){var i=this.isPointInBefore(t,e,s);return t=i[0],e=i[1],t>this.attrs.x&&e>this.attrs.y&&t<this.attrs.x+this.attrs.width&&e<this.attrs.y+this.attrs.height},bounds:function(t,e){return this.super("bounds",[[this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height],t,e])},draw:function(t){this.attrs.visible&&(this.preDraw(t),this.styles.fillStyle&&t.fillRect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height),this.styles.strokeStyle&&t.strokeRect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height),t.restore())},processPath:function(t){t.beginPath(),t.rect(this.attrs.x,this.attrs.y,this.attrs.width,this.attrs.height)}}),["x","y","width","height","x1","x2","y1","y2"].forEach(function(t,e){var s=n.prototype.attrHooks[3<e?"_numAttr":"_num"];r.prototype.attrHooks[t].preAnim=s.preAnim,r.prototype.attrHooks[t].anim=s.anim}),f.rect=function(){return new r(arguments)},f.Rect=r,(e=new H(n,{argsOrder:["cx","cy","radius","fill","stroke"],attrHooks:new z({cx:{set:F},cy:{set:F},radius:{set:F}}),isPointIn:function(t,e,s){s=("mouse"===s?this.attrs.interactionProps:s)||{};var i=this.isPointInBefore(t,e,s);t=i[0],e=i[1];var r=s.stroke?(this.styles.lineWidth||0)/2:0;return Math.pow(t-this.attrs.cx,2)+Math.pow(e-this.attrs.cy,2)<=Math.pow(this.attrs.radius+r,2)},bounds:function(t,e){return this.super("bounds",[[this.attrs.cx-this.attrs.radius,this.attrs.cy-this.attrs.radius,2*this.attrs.radius,2*this.attrs.radius],t,e])},draw:function(t){this.attrs.visible&&(this.preDraw(t),t.beginPath(),t.arc(this.attrs.cx,this.attrs.cy,Math.abs(this.attrs.radius),0,2*Math.PI,!0),this.postDraw(t))},processPath:function(t){t.beginPath(),t.arc(this.attrs.cx,this.attrs.cy,Math.abs(this.attrs.radius),0,2*Math.PI,!0)}})).args=["cx","cy","radius","fill","stroke"],["cx","cy","radius"].forEach(function(t){e.prototype.attrHooks[t].preAnim=n.prototype.attrHooks._num.preAnim,e.prototype.attrHooks[t].anim=n.prototype.attrHooks._num.anim}),f.circle=function(){return new e(arguments)},f.Circle=e,(h=new H({initialize:function(t,e,s){this.method=t,this.path=s,this.attrs={},this.attrs.args=e,h.canvasFunctions[t]&&(this.attrHooks=h.canvasFunctions[t].attrHooks)},attrHooks:R.prototype={args:{set:function(){this.update()}}},attr:H.attr,clone:function(){var t=f.curve(this.method,this.attrs.args);return x(t.attrs,this.attrs),t},startAt:function(){var t=this.path.attrs.d.indexOf(this);return 0===t?[0,0]:this.path.attrs.d[t-1].endAt()},endAt:function(){return h.canvasFunctions[this.method].endAt?h.canvasFunctions[this.method].endAt(this.attrs.args):null},update:function(){return this.path&&this.path.update(),this},bounds:function(t){return h.canvasFunctions[this.method].bounds?(t||(t=this.startAt()),h.canvasFunctions[this.method].bounds(t,this.attrs.args)):null},process:function(t){t[this.method].apply(t,this.attrs.args)}})).AttrHooks=R,h.canvasFunctions={moveTo:{attrHooks:L(["x","y"]),endAt:function(t){return t.slice()}},lineTo:{attrHooks:L(["x","y"]),bounds:function(t,e){return[t[0],t[1],e[0],e[1]]},endAt:function(t){return t.slice()}},quadraticCurveTo:{attrHooks:L(["hx","hy","x","y"]),bounds:function(t,e){return[Math.min(t[0],e[0],e[2]),Math.min(t[1],e[1],e[3]),Math.max(t[0],e[0],e[2]),Math.max(t[1],e[1],e[3])]},endAt:function(t){return t.slice(2)}},bezierCurveTo:{attrHooks:L(["h1x","h1y","h2x","h2y","x","y"]),bounds:function(t,e){return[Math.min(t[0],e[0],e[2],e[4]),Math.min(t[1],e[1],e[3],e[5]),Math.max(t[0],e[0],e[2],e[4]),Math.max(t[1],e[1],e[3],e[5])]},endAt:function(t){return t.slice(4)}},arc:{attrHooks:L(["x","y","radius","start","end","clockwise"]),bounds:function(t,e){var s=e[0],i=e[1],r=e[2];e[3],e[4],e[5];return[s-r,i-r,s+r,i+r]},endAt:function(t){var e=t[0],s=t[1],i=t[2],r=t[4]-t[3];return t[5]&&(r=-r),[e+Math.cos(r)*i,s+Math.sin(r)*i]}},arcTo:{attrHooks:L(["x1","y1","x2","y2","radius","clockwise"])}},h.fromArray=function(t,e){return!0===t?closePath:t[0]in f.curves?f.curve(t[0],t.slice(1),e):new h({2:"lineTo",4:"quadraticCurveTo",6:"bezierCurveTo"}[t.length],t,e)},f.curves={moveTo:h,lineTo:h,quadraticCurveTo:h,bezierCurveTo:h,arc:h,arcTo:h,closePath:h},f.Curve=h,f.curve=function(t,e,s){return new f.curves[t](t,e,s)},(u=new H(n,{initialize:function(t){t[0].constructor!==Object&&t[1].constructor!==Number&&(t[3]=t[1],t[4]=t[2],t[1]=t[2]=o),this.super("initialize",arguments)},argsOrder:["d","x","y","fill","stroke"],attrHooks:new z({d:{set:F},x:{set:F},y:{set:F}}),curve:function(t,e){return e===o?this.attrs.d[t]:(isNaN(e[0])||(e=[e]),e=u.parse(e,this,0!==t),this.attrs.d.splice.apply(this.attrs.d,[t,1].concat(e)),this.update())},curves:function(t){return t===o?this.attrs.d:(this.attrs.d=u.parse(t,this,!0),this.update())},before:function(t,e,s){return 0===t&&!1!==turnToLine&&(this.attrs.d[0].method="lineTo"),isNaN(e[0])||(e=[e]),e=u.parse(e,this,0!==t),this.attrs.d.splice.apply(this.attrs.d,[t,0].concat(e)),this.update()},after:function(t,e){return this.before(t+1,e)},remove:function(t){return t===o?this.super("remove"):(this.attrs.d[t].path=null,this.attrs.d.splice(t,1),this.update())},push:function(t,e){return e?this.attrs.d.push(f.curve(t,e,this)):this.attrs.d=this.attrs.d.concat(u.parse(t,this,0!==this.attrs.d.length)),this.update()},each:function(){return this.attrs.d.forEach.apply(this.attrs.d,arguments),this},map:function(){return this.attrs.d.map.apply(this.attrs.d,arguments)},moveTo:function(t,e){return this.push("moveTo",[t,e])},lineTo:function(t,e){return this.push("lineTo",[t,e])},quadraticCurveTo:function(t,e,s,i){return this.push("quadraticCurveTo",[t,e,s,i])},bezierCurveTo:function(t,e,s,i,r,n){return this.push("bezierCurveTo",[t,e,s,i,r,n])},arcTo:function(t,e,s,i,r,n){return this.push("arcTo",[t,e,s,i,r,!!n])},arc:function(t,e,s,i,r,n){return this.push("arc",[t,e,s,i,r,!!n])},closePath:function(){return this.push("closePath",[])},isPointIn:function(t,e,s){var i=this.isPointInBefore(t,e,s);t=i[0],e=i[1];var r=this.context.context;r.save();var n=this.getTransform();f.isIdentityTransform(n)||r.transform(n[0],n[1],n[2],n[3],n[4],n[5]),(this.attrs.x||this.attrs.y)&&r.translate(this.attrs.x||0,this.attrs.y||0),this.attrs.d.forEach(function(t){t.process(r)});var a=r.isPointInPath(t,e);return r.restore(),a},bounds:function(t,e){for(var s,i=1/0,r=1/0,n=-1/0,a=-1/0,o=[0,0],h=0;h<this.attrs.d.length;h++)s=this.attrs.d[h].bounds(o),o=this.attrs.d[h].endAt()||o,s&&(i=Math.min(i,s[0],s[2]),n=Math.max(n,s[0],s[2]),r=Math.min(r,s[1],s[3]),a=Math.max(a,s[1],s[3]));return this.super("bounds",[[i,r,n-i,a-r],t,e])},process:function(e){e.beginPath(),this.attrs.d.forEach(function(t){t.process(e)})},draw:function(t){}})).args=["d","x","y","fill","stroke"],u.parse=function(t,e,s){if(!t)return[];if(t instanceof h)return t.path=e,[t];t[0]===o||+t[0]!==t[0]&&t[0]+""!==t[0]||(t=[t]);var i=[];if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]instanceof h?(i.push(t[r]),t[r].path=e):0!==r||s?i.push(h.fromArray(t[r],e)):i.push(new h("moveTo",isNaN(t[r][0])?t[r].slice(1):t[r],e));return i},f.path=function(){return new u(arguments)},f.Path=u,(c=new H(n,{initialize:function(t){this.super("initialize",arguments),T(t[0])&&(t=this.processObject(t[0],c.args)),this.attrs.image=c.parse(t[0]),this.attrs.x=t[1],this.attrs.y=t[2],this.attrs.width=t[3]===o?"auto":t[3],this.attrs.height=t[4]===o?"auto":t[4],t[5]&&(this.attrs.crop=t[5]),this.attrs.image.addEventListener("load",function(t){this.update(),this.fire("load",t)}.bind(this)),this.attrs.image.addEventListener("error",function(t){this.fire("error",event)}.bind(this))},attrHooks:new z({image:{set:function(t){return(t=c.parse(t)).complete&&this.update(),t.addEventListener("load",function(t){this.update(),this.fire("load",t)}.bind(this)),t}},x:{set:function(t){this.attrs.x=t,this.update()}},y:{set:function(t){this.attrs.y=t,this.update()}},width:{set:function(t){this.attrs.width=t,this.update()}},height:{set:function(t){this.attrs.height=t,this.update()}},crop:{set:function(t){this.attrs.crop=t,this.update()}},smooth:{get:function(){return this.styles[D(this.context.context)]||this.context.context[D(this.context.context)]},set:function(t){this.styles[D(this.context.context)]=!!t,this.update()}}}),remove:function(){this.super("remove"),this.attrs.image.blob&&v.revokeObjectURL(this.attrs.image.blob)},getRealSize:function(){var t=this.attrs.width,e=this.attrs.height;return"auto"===t&&"auto"===e&&(t=e="native"),"auto"===t?t=this.attrs.image.width*(e/this.attrs.image.height):"native"===t&&(t=this.attrs.image.width),"auto"===e?e=this.attrs.image.height*(t/this.attrs.image.width):"native"===e&&(e=this.attrs.image.height),[t,e]},bounds:function(t,e){var s=this.getRealSize();return this.super("bounds",[[this.attrs.x,this.attrs.y,s[0],s[1]],t,e])},isPointIn:function(t,e){var s=this.isPointInBefore(t,e,options);t=s[0],e=s[1];var i=this.getRealSize();return t>this.attrs.x&&e>this.attrs.y&&t<this.attrs.x+i[0]&&e<this.attrs.y+i[1]},draw:function(t){if(this.attrs.visible&&this.attrs.image.complete){this.context.renderer.pre(t,this.styles,this.matrix,this);this.attrs.image,this.attrs.x,this.attrs.y;var e=this.attrs.width,s=this.attrs.height,i=this.attrs.crop;if("auto"===this.attrs.width||"native"===this.attrs.width||"auto"===this.attrs.height||"native"===this.attrs.height){var r=this.getRealSize();e=r[0],s=r[1]}i?t.drawImage(this.attrs.image,i[0],i[1],i[2],i[3],this.attrs.x,this.attrs.y,e,s):"auto"!==this.attrs.width&&"native"!==this.attrs.width||"auto"!==this.attrs.height&&"native"!==this.attrs.height?t.drawImage(this.attrs.image,this.attrs.x,this.attrs.y,e,s):t.drawImage(this.attrs.image,this.attrs.x,this.attrs.y),t.restore()}}})).args=["image","x","y","width","height","crop"],c.parse=function(t){if(t+""===t){if("#"===t[0])return d.getElementById(t.substr(1));if("<svg"!==t[0]){var e=new Image;return e.src=t,e}var s=new Blob([t],{type:"image/svg+xml;charset=utf-8"});(t=new Image).src=v.createObjectURL(s),t.blob=s}return t},f.image=function(){return new c(arguments)},f.Image=c;(t=new H(n,{argsOrder:["text","x","y","font","fill","stroke"],attrHooks:new z({text:{set:function(t){return this.lines=null,this.update(),t+""}},x:{set:F},y:{set:F},font:{set:function(t){}},align:{get:function(){return this.styles.textAlign||"left"},set:function(t){return this.styles.textAlign=t,this.update(),null}},baseline:{get:function(){return this.styles.textBaseline},set:function(t){return this.styles.textBaseline=t,this.update(),null}},breaklines:{set:function(){this.update()}},lineHeight:{set:function(){this.lines=null,this.update()}},maxStringWidth:{set:function(){this.update()}},blockWidth:{set:function(){this.lines=null,this.update()}}}),lines:null,processLines:function(t){var e=this.attrs.text,n=this.lines=[],a="auto"===this.attrs.lineHeight?this.attrs.font.size:this.attrs.lineHeight,o=this.attrs.blockWidth,h=("center"===this.styles.textAlign||this.styles.textAlign,this.context.renderer);return h.preMeasure(this.styles.font),e.split("\n").forEach(function(t){if(h.measure(t)>o){for(var e,s=t.split(" "),i="",r=0;r<s.length;r++)e=i+s[r]+" ",i=h.measure(e)>o?(n.push({text:i,y:a*n.length}),s[r]+" "):e;n.push({text:i,y:a*n.length})}else n.push({text:t,y:a*n.length})},this),h.postMeasure(),this},draw:function(t){},isPointIn:function(t,e,s){var i=this.isPointInBefore(t,e,s);t=i[0],e=i[1];var r=this.bounds(!1);return t>r.x1&&e>r.y1&&t<r.x2&&e<r.y2},measure:function(){var t;return t=this.attrs.breaklines?(this.lines||this.processLines(this.context.context),this.context.renderer.preMeasure(this.styles.font),this.lines.reduce(function(t,e){return t<(e=this.context.renderer.measure(e.text))?e:t}.bind(this),0)):(this.context.renderer.preMeasure(this.styles.font),this.context.renderer.measure(this.attrs.text)),this.context.renderer.postMeasure(),t},bounds:function(t,e){var s,i=this.attrs.x,r=this.attrs.y,n="auto"===this.attrs.lineHeight?this.attrs.font.size:this.attrs.lineHeight;this.attrs.breaklines?(s=this.attrs.blockWidth,"inline"!==this.attrs.boundsMode&&isFinite(s)||(s=this.measure()),this.lines||this.processLines(),n*=this.lines.length):(s=this.measure(),this.attrs.maxStringWidth<s&&(s=this.attrs.maxStringWidth));var a=this.styles.textBaseline,o=this.styles.textAlign;return"middle"===a?r-=this.attrs.font.size/2:"bottom"===a||"ideographic"===a?r-=this.attrs.font.size:"alphabetic"===a&&(r-=.8*this.attrs.font.size),"center"===o?i-=s/2:"right"===o&&(i-=s),this.super("bounds",[[i,r,s,n],t,e])}})).font="10px sans-serif",t.args=["text","x","y","font","fill","stroke"],t.parseFont=function(t){if(t+""!==t)return t;var e={family:""};return t.split(" ").forEach(function(t){"bold"===t?e.bold=!0:"italic"===t?e.italic=!0:b.test(t)?e.size=f.distance(t):e.family+=" "+t}),e.family=e.family.trim(),e},t.genFont=function(t){var e="";return t.italic&&(e+="italic "),t.bold&&(e+="bold "),e+(t.size||10)+"px "+(t.family||"sans-serif")},f.text=function(){return new t(arguments)},f.Text=t,(l=new H({initialize:function(t,e,s,i,r){if(this.context=r,t+""!==t&&(i=s,s=e,e=t,t="linear"),!l.types[t])throw'Unknown gradient type "'+t+'"';this.type=t,this.attrs={from:s,to:i,colors:l.parseColors(e)},this.binds=[],l.types[this.type]&&(this.attrHooks=x(x({},this.attrHooks),l.types[this.type].attrHooks),l.types[this.type].initialize&&l.types[this.type].initialize.call(this))},attr:H.attr,attrHooks:{colors:{set:function(t){return this.update(),l.parseColors(t)}}},color:function(t,e){if(e!==o)return this.attrs.colors[t]=e,this.update();if(this.attrs.colors[t])return f.color(this.attrs.colors[t]);var s=this.attrs.colors,i=Object.keys(s).sort();if(t<i[0])return f.color(s[i[0]]);if(t>i[i.length-1])return f.color(s[i[i.length-1]]);for(var r=0;r<i.length;r++)if(+i[r]>t){var n=f.color(s[i[r-1]]),a=f.color(s[i[r]]);return t=(t-+i[r-1])/(+i[r]-+i[r-1]),[n[0]+(a[0]-n[0])*t+.5|0,n[1]+(a[1]-n[1])*t+.5|0,n[2]+(a[2]-n[2])*t+.5|0,+(n[3]+(a[3]-n[3])*t).toFixed(2)]}},update:function(){return this.context.update(),this},toCanvasStyle:function(t,e){return l.types[this.type].toCanvasStyle.call(this,t,e)}})).parseColors=function(t){if(!Array.isArray(t))return t;var s={},i=1/(t.length-1);return t.forEach(function(t,e){s[i*e]=t}),s},l.types={linear:{attrHooks:{from:{set:function(t){return this.update(),t}},to:{set:function(t){return this.update(),t}}},toCanvasStyle:function(t,e){return this.context.renderer.makeGradient(this.context,"linear",e.corner(this.attrs.from),e.corner(this.attrs.to),this.attrs.colors)}},radial:{initialize:function(){this.attrs.from&&Array.isArray(this.attrs.from)?(this.attrs.startRadius=this.attrs.from[2]||0,this.attrs.from=this.attrs.from.slice(0,2)):(this.attrs.from||(this.attrs.from="center"),this.attrs.startRadius=0),this.attrs.to&&Array.isArray(this.attrs.to)?(this.attrs.radius=this.attrs.to[2]||"auto",this.attrs.to=this.attrs.to.slice(0,2)):(this.attrs.to||(this.attrs.to=this.attrs.from),this.attrs.radius="auto")},attrHooks:{from:{set:function(t){return Array.isArray(t)&&2<t.length&&(this.attrs.startRadius=t[2],t=t.slice(0,2)),this.update(),t}},to:{set:function(t){return Array.isArray(t)&&2<t.length&&(this.attrs.radius=t[2],t=t.slice(0,2)),this.update(),t}},radius:{set:function(t){return this.update(),t}},startRadius:{set:function(t){return this.update(),t}}},toCanvasStyle:function(t,e){var s=e.corner(this.attrs.from),i=e.corner(this.attrs.to);return this.context.renderer.makeGradient(this.context,"radial",[s[0],s[1],this.attrs.startRadius],[i[0],i[1],"auto"===this.attrs.radius?e.bounds().height:this.attrs.radius],this.attrs.colors)}}},f.Gradient=l,s=new H({initialize:function(t,e,s){this.image=c.parse(t),this.repeat=e,this.context=s,this.image.addEventListener("load",function(t){this.update(),this.image.blob&&v.revokeObjectURL(blob)}.bind(this))},update:function(){return this.context.update(),this},toCanvasStyle:function(t){return this.image.complete?t.createPattern(this.image,this.repeat||"repeat"):"transparent"}}),f.Pattern=s,f.version="1.9.0",f.query=function(t,e,s,i){return t+""===t&&(t=(i||d).querySelectorAll(t)[s||0]),new f.contexts[e||"2d"](t.canvas||t)},f.id=function(t,e){return new f.contexts[e||"2d"](d.getElementById(t))},"object"==typeof module&&"object"==typeof module.exports?module.exports=f:"function"==typeof define&&define.amd?define("Delta",[],function(){return f}):i&&(i.Delta=f)}("undefined"!=typeof window?window:this);