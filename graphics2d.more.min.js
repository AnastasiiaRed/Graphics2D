!function(a,b,c){function d(a,b,c,d,e,f,g,h,i){return{x:.5*((-a+3*c-3*e+g)*i*i*i+(2*a-5*c+4*e-g)*i*i+(-a+e)*i+2*c),y:.5*((-b+3*d-3*f+h)*i*i*i+(2*b-5*d+4*f-h)*i*i+(-b+f)*i+2*d)}}function e(a){return function(b){return this.argument(a,b)}}function f(a,b){for(var c=[],d=a.length;d>b;b+=2)c.push(a[b]);return c}function g(a){return 1===a||0===a?1:a*g(a-1)}function h(a,b){return g(b)/(g(a)*g(b-a))}function i(a,b){for(var c=a.length,d=c-1,e=0,f=1-b,g=0;c>e;e++)g+=h(e,d)*Math.pow(b,e)*Math.pow(f,d-e)*a[e];return g}function j(a,b){return a+b[0].toUpperCase()+b.substr(1)}function k(a){for(var b=[];a--;)b[a]=a;return b}var l,m,n,o=b.Context,p=b.Shape,q=b.Rect,r=(b.Circle,b.Curve),t=(b.Path,b.Image),u=(b.Text,b.TextBlock,b.Gradient,b.Pattern,b.Class),v=b.isObject,w=b.isObject,x=b.isString,y=b.extend,z=2*Math.PI,A=function(){};l=new u(p,{init:function(){var a=this._cx;v(a)?(this._cx=a.cx||a.x||0,this._cy=a.cy||a.y||0,a.radius!==c?this._rx=this._ry=a.radius:(this._rx=a.rx,this._ry=a.ry),a.kappa!==c&&(this._kappa=a.kappa),this._parseHash(a)):this._processStyle()},_kappa:4/3*(Math.sqrt(2)-1),cx:function(a){return this._property("cx",a)},cy:function(a){return this._property("cy",a)},rx:function(a){return this._property("rx",a)},ry:function(a){return this._property("ry",a)},kappa:function(a){return this._property("kappa",a)},bounds:function(){return new Bounds(this._cx-this._rx,this._cy-this._ry,2*this._rx,2*this._ry)},processPath:function(a){if(a.beginPath(),a.ellipse&&this._kappa===l.kappa)return void a.ellipse(this._cx,this._cy,this._rx,this._ry,0,0,2*Math.PI,!0);var b=this._kappa,c=this._cx,d=this._cy,e=this._rx,f=this._ry,g=e*b,h=f*b;a.moveTo(c-e,d),a.bezierCurveTo(c-e,d-h,c-g,d-f,c,d-f),a.bezierCurveTo(c+g,d-f,c+e,d-h,c+e,d),a.bezierCurveTo(c+e,d+h,c+g,d+f,c,d+f),a.bezierCurveTo(c-g,d+f,c-e,d+h,c-e,d),a.closePath()}}),l.props=["cx","cy","rx","ry","fill","stroke"],l.kappa=l.prototype._kappa,o.prototype.ellipse=function(){return this.push(new l(arguments,this))},b.fx.step.kappa=b.fx.step.float,m=new u(p,{init:function(){var a=this._cx;v(a)?(this._cx=a.cx||a.x||0,this._cy=a.cy||a.y||0,this._radius=a.radius,this._sides=a.sides,this._parseHash(a)):this._processStyle()},cx:function(a){return this._property("cx",a)},cy:function(a){return this._property("cy",a)},radius:function(a){return this._property("radius",a)},sides:function(a){return this._property("sides",a)},bounds:function(){return new Bounds(this._cx-this._radius,this._cy-this._radius,2*this._radius,2*this._radius)},processPath:function(a){var b,c=z/this._sides,d=0;for(a.beginPath();d<this._sides;d++)b=c*d,a.lineTo(this._cx+this._radius*Math.cos(b),this._cy+this._radius*Math.sin(b));a.closePath()}}),m.props=["cx","cy","radius","sides","fill","stroke"],o.prototype.polygon=function(){return this.push(new m(arguments,this))},b.fx.step.sides=b.fx.step.int,n=new u(p,{init:function(){var a=this._cx;v(a)?(this._cx=a.cx||a.x||0,this._cy=a.cy||a.y||0,this._radius1=a.radius1||(a.radius?a.radius[0]:0),this._radius2=a.radius2||(a.radius?a.radius[1]:0),this._points=a.points,this._distortion=a.distortion||0,this._parseHash(a)):this._processStyle()},_distortion:0,cx:function(a){return this._property("cx",a)},cy:function(a){return this._property("cy",a)},radius1:function(a){return this._property("radius1",a)},radius2:function(a){return this._property("radius2",a)},points:function(a){return this._property("points",a)},distortion:function(a){return this._property("distortion",a)},bounds:function(){var a=Math.max(this._radius1,this._radius2);return new Bounds(this._cx-a,this._cy-a,2*a,2*a)},processPath:function(a){var b,c,d=Math.PI/this._points,e=0;for(a.beginPath();e<this._points;e++)b=z*e/this._points,c=b+d+this._distortion,a.lineTo(this._cx+this._radius1*Math.cos(b),this._cy+this._radius1*Math.sin(b)),a.lineTo(this._cx+this._radius2*Math.cos(c),this._cy+this._radius2*Math.sin(c));a.closePath()}}),n.props=["cx","cy","radius1","radius2","points","fill","stroke"],o.prototype.star=function(){return this.push(new n(arguments,this))},b.fx.step.radius1=b.fx.step.int,b.fx.step.radius2=b.fx.step.int,b.fx.step.points=b.fx.step.int,b.fx.step.distortion=b.fx.step.float,q.prototype._rx=0,q.prototype._ry=0,q.prototype.initialize=function(){var a=this._x;v(a)&&(this._rx=a.rx||a.radius||0,this._ry=a.ry||a.radius||0)},q.prototype.processPath=function(a){var b=this._x,c=this._y,d=this._width,e=this._height,f=this._rx,g=this._ry;a.beginPath(),0===f&&0===g?a.rect(this._x,this._y,this._width,this._height):(a.moveTo(b,c+g),a.lineTo(b,c+e-g),a.quadraticCurveTo(b,c+e,b+f,c+e),a.lineTo(b+d-f,c+e),a.quadraticCurveTo(b+d,c+e,b+d,c+e-g),a.lineTo(b+d,c+g),a.quadraticCurveTo(b+d,c,b+d-f,c),a.lineTo(b+f,c),a.quadraticCurveTo(b,c,b,c+g),a.closePath())},q.prototype.rx=function(a){return this._property("rx",a)},q.prototype.ry=function(a){return this._property("ry",a)},b.fx.step.rx=b.fx.step.int,b.fx.step.ry=b.fx.step.int,r.curves.catmullRom={pointAt:function(){},process:function(a,b){for(var c,e=this._arguments,f=this._detail,g=0;f>g;g++)c=d(e[0],e[1],b[0],b[1],e[2],e[3],e[4],e[5],g/f),a.lineTo(c.x,c.y);return[e[4],e[5]]},_detail:50,h1x:e(0),h1y:e(1),h2x:e(4),h2y:e(5),x:e(2),y:e(3),_slice:[4]},r.curves.bezier={pointAt:function(){},process:function(a,b){for(var c,d,e=[b[0]].concat(f(this._arguments,0)),g=[b[1]].concat(f(this._arguments,1)),h=this._detail,j=0;h>=j;j++)c=i(e,j/h),d=i(g,j/h),a.lineTo(c,d);return this._arguments.slice(this._arguments.length-2)},_detail:50},y(r.prototype,{tangentAt:function(a,b){b===c&&(b=1e-4);var d=a-b,e=a+b;0>d&&(d=0),e>1&&(e=1);var f=this.pointAt(d),g=this.pointAt(e);return 180*Math.atan2(g.y-f.y,g.x-f.x)/Math.PI},normalAt:function(a,b){return this.tangentAt(a,b)+90},nearest:function(a,b,d){d===c&&(d=10);for(var e,f,g,h=1/0,i=0;d>=i;i++)e=this.pointAt(i/d),g=Math.sqrt(Math.pow(e.x-a,2)+Math.pow(e.y-b,2)),h>g&&(h=g,f=e,f.distance=g,f.t=i/d);return f},approximate:function(a){a===c&&(a=10);for(var a,b=[],d=this.pointAt(0),e=1;a>=e;e++)point=this.pointAt(e/a),b.push({x1:d.x,y1:d.y,x2:point.x,y2:point.y}),d=point;return b},length:function(a){for(var b=this.approximate(a),c=0,d=0,e=b.length;e>d;d++)c+=Math.sqrt(Math.pow(b[d].x2-b[d].x1,2)+Math.pow(b[d].y2-b[d].y1,2));return c},bounds:function(a){for(var b=this.approximate(a),c=1/0,d=1/0,e=-1/0,f=-1/0,g=0,h=b.length;h>g;g++)c=Math.min(c,b[g].x1,b[g].x2),d=Math.min(d,b[g].y1,b[g].y2),e=Math.min(e,b[g].x1,b[g].x2),f=Math.min(f,b[g].y1,b[g].y2);return new Bounds(c,d,e-c,f-d)}}),y(r.curves.lineTo,{pointAt:function(a,b){var b=this.from(),c=this._arguments;return{x:(1-a)*b[0]+a*c[0],y:(1-a)*b[1]+a*c[1]}},tangentAt:function(){var a=this.from(),b=this._arguments;return 180*Math.atan2(b[1]-a[1],b[0]-a[0])/Math.PI},length:function(){var a=this.from(),b=this._arguments;return Math.sqrt(Math.pow(b[1]-a[1],2)+Math.pow(b[0]-a[0],2))},divide:function(){return[]}}),y(r.curves.quadraticCurveTo,{pointAt:function(a){var b=this.from()[0],c=this.from()[1],d=this._arguments[0],e=this._arguments[1],f=this._arguments[2],g=this._arguments[3],h=1-a;return{x:h*h*b+2*a*h*d+a*a*f,y:h*h*c+2*a*h*e+a*a*g}},toCubic:function(){var a=this.from(),b=this._arguments[0],c=this._arguments[1],d=this._arguments[2],e=this._arguments[3],f=2/3;this._name="bezierCurveTo",this._arguments=[a[0]+f*(b-a[0]),a[1]+f*(c-a[1]),d+f*(b-a[0]),e+f*(c-a[1])]}}),y(r.curves.bezierCurveTo,{pointAt:function(a){var b=this.from()[0],c=this.from()[1],d=this._arguments[0],e=this._arguments[1],f=this._arguments[2],g=this._arguments[3],h=this._arguments[4],i=this._arguments[5],j=1-a;return{x:j*j*j*b+3*a*j*j*d+3*a*a*j*f+a*a*a*h,y:j*j*j*c+3*a*j*j*e+3*a*a*j*g+a*a*a*i}}}),y(r.curves.arc,{pointAt:function(){this.from()[0],this.from()[1]}}),b.fx.step.curve=function(a){if(0===a.state&&(a.elem._matrix||(a.elem._matrix=[1,0,0,1,0,0]),a.elem._bounds||a.elem.bounds&&a.elem.bounds!==p.prototype.bounds)){var b=a.elem.bounds();a.elem._matrix[4]-=b.cx,a.elem._matrix[5]-=b.cy}a.pointLast&&(a.elem._matrix[4]-=a.pointLast.x,a.elem._matrix[5]-=a.pointLast.y);var c=a.end.pointAt(a.pos);a.elem._matrix[4]+=c.x,a.elem._matrix[5]+=c.y,a.pointLast=c},b.fx.step.curveAngle=function(a){if(0===a.state&&(a.elem._matrix||(a.elem._matrix=[1,0,0,1,0,0]),a.elem._bounds)){var b=a.elem.bounds();a.elem._matrix[4]-=b.cx,a.elem._matrix[5]-=b.cy}a.pointLast&&(a.elem._matrix[4]-=a.pointLast.x,a.elem._matrix[5]-=a.pointLast.y,a.elem.rotate(-a.ang));var c=a.end.pointAt(a.pos),d=a.end.tangentAt(a.pos);a.elem._matrix[4]+=c.x,a.elem._matrix[5]+=c.y,a.elem.rotate(d),a.pointLast=c,a.ang=d};var B=Image.prototype.draw;Image.prototype.filter=function(a,d){if(!this._image.complete)return this.on("load",function(){this.filter(a,d)});var e=this.context.context.getImageData(this._x,this._y,this._width,this._height);if("function"!=typeof a){if(b.filters[a]===c)throw new Error('Filter "'+a+'" is not defined.');a=b.filters[a]}return a.call(this,e.data,d||{})!==!1&&(this._imageData=e,this.context.context.putImageData(e,this._x,this._y)),this},Image.prototype.draw=function(a){return this._imageData?a.putImageData(this._imageData,this._x,this._y):B.call(this,a),this},b.filters={pixel:function(a,b){for(var c,d=0,e=a.length;e>d;d+=4)c=b(a[d],a[d+1],a[d+2],a[d+3],d),a[d]=c[0],a[d+1]=c[1],a[d+2]=c[2],a[d+3]=c[3]},vertex:function(a,b){for(var c,d=this._width,e=this._height,f=this.context.context.createImageData(d,e),g=f.data,h=0,i=a.length;i>h;h+=4)c=b(h/4%d,Math.floor(h/4/d),a[h],a[h+1],a[h+2],a[h+3],h),c=4*(d*c[1]+c[0]),g[c]=a[h],g[c+1]=a[h+1],g[c+2]=a[h+2],g[c+3]=a[h+3];return this._imageData=f,this.update(),!1}};var C,D=a.Element.prototype,E="requestFullScreen",F="cancelFullScreen",G="fullscreenchange",H="fullScreenElement",I="fullScreenEnabled";"mozRequestFullScreen"in D?C="moz":"webkitRequestFullScreen"in D&&(C="webkit"),C&&(E=j(C,E),F=j(C,F),G=C+G,H=j(C,H),I=j(C,I)),o.prototype.fullscreen=function(b){this.isFullscreen()||(this.canvas[E](),b?(this.normalState={width:this.canvas.width,height:this.canvas.height},setTimeout(function(){this.canvas.width=a.innerWidth,this.canvas.height=a.innerHeight,this.update()}.bind(this),10),this._resizeListener=function(a){null===document[H]&&(document.removeEventListener(G,this._resizeListener),this.fire("exitfull",a),this.canvas.width=this.normalState.width,this.canvas.height=this.normalState.height,this.normalState=null,this._resizeListener=null,this.update())}.bind(this),document.addEventListener(G,this._resizeListener)):(this._resizeListener=function(a){null===document[H]&&(document.removeEventListener(G,this._resizeListener),this.fire("exitfull",a))}.bind(this),document.addEventListener(G,this._resizeListener)),this.fire("fullscreen"))},o.prototype.isFullscreen=function(){return document[H]===this.canvas},o.prototype.exitfull=function(){this.isFullscreen()&&(document[F](),this.fire("exitfull"),this._resizeListener&&(document.removeEventListener(G,this._resizeListener),this._resizeListener=null),this.normalState&&(this.canvas.width=this.normalState.width,this.canvas.height=this.normalState.height,this.normalState=null,this.update()))},C||"requestFullScreen"in D||(o.prototype.fullscreen=function(){},o.prototype.isFullscreen=function(){},o.prototype.exitfull=function(){}),b.Context.prototype.imageanim=function(){return this.push(new J(arguments,this))},b.multiplePath=function(a){for(var b=[],c=/\[(\d+)\-(\d+)\]/,d=a.match(c),e=Number(d[1]),f=Number(d[2]);f>=e;e++)b.push(a.replace(c,e));return b};var J=b.Class(t,{init:function(){var a=this._image;this._frames=[],this._sequences=[],w(a)&&(this._image=a.image,this._x=a.x,this._y=a.y,this._width=a.width,this._height=a.height,this._crop=a.crop,this._parseHash(a)),x(this._image)&&(this._image=b.multiplePath(this._image));var c;this._image.forEach(function(a){x(a)&&(c=new Image,c.src=a,a=c),this._frames.push(a)}.bind(this)),this._image=this._frames[0],this._image.complete&&(s=this._computeSize(this._width,this._height,this._image),this._width=s[0],this._height=s[1]),this._image.addEventListener("load",function(a){s=this._computeSize(this._width,this._height,this._image),this._width=s[0],this._height=s[1],this.update(),this.fire("load",a)}.bind(this)),this._image.addEventListener("error",function(a){this.fire("error",a)}.bind(this))},_startFrame:0,frame:function(a){return a===c?this._frame:(this._frame=a,this._image=this._frames[a],this.fire("frame",{frame:a}),this.update())},nextframe:function(){return this.frame(this._frame===this._frames.length-1?0:this._frame+1)},prevframe:function(){return this.frame(0===this._frame?this._frames.length-1:this._frame-1)},sequence:function(a,b){this._sequences[a]=b},play:function(b,d,e,f){x(b)&&(b=this._sequences[b]),b||(b=k(this._frames.length)),d||(d=60),"function"==typeof e&&(f=e,e=!0),e===c&&(e=!0),f===c&&(f=A);var g=0;0>d?(g=b.length-1,this._timer=a.setInterval(function(){0===g&&(e?(g=b.length-1,f.call(this)):f.call(this.stop())),this.frame(b[g--])}.bind(this),-d)):this._timer=a.setInterval(function(){b.length===g&&(e?(g=0,f.call(this)):f.call(this.stop())),this.frame(b[g++])}.bind(this),d)},stop:function(){return a.clearInterval(this._timer),this._timer=null,this},toggle:function(){return null===this._timer?this.play.apply(this,arguments):this.stop(),this},isPlaying:function(){return null!==this._timer},_frame:0});J.props=["image","x","y","width","height","crop"],J.distances=[!1,!0,!0,!0,!0],b.Ellipse=l,b.Polygon=m,b.Star=n,b.ImageAnim=J}("undefined"!=typeof window?window:this,Graphics2D);